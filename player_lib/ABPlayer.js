function isMobile(){}function createCORSRequest(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t)):i=null,i}Array.from=Array.from||function(e){return[].slice.call(e)},function(){var e=null,t=function(t,i,n,a){null==n&&(n=function(){}),null!=e&&(e.abort(),e=null),e=new XMLHttpRequest,e.open("GET",t,!0),e.send();var o=i;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var t,i=null==e.responseXML?(new window.DOMParser).parseFromString(e.responseText,"text/xml"):e.responseXML;0==i.getElementsByTagName("parsererror").length?t=BilibiliParser(i):(console.warn("XML解析失败，尝试纯文本解析"),t=BilibiliParser(null,e.response)),o.load(t),shield.shield(),n(),e=null}}};window.CommentLoader=t}();var ABP={version:"0.8.0"};(function(){"use strict";if(ABP){var e=jQuery,t=window.setTimeout,i=window.clearTimeout,n="addEventListener",a="HTML5 Player ver.190427 based on ABPlayer-bilibili-ver",o=[0,0],l=function(e){var t=o;return o=[e.clientX,e.clientY],!(t[0]==o[0]&&t[1]==o[1])},s=function(e){return document.getElementById(e)},r=function(e,t,i){var n=null;if("text"===e)return document.createTextNode(t);n=document.createElement(e);for(var a in t)if("style"===a)for(var o in t.style)n.style[o]=t.style[o];else if("className"===a)n.className=t[a];else if("event"===a)for(var o in t.event)n.addEventListener(o,t.event[o]);else n.setAttribute(a,t[a]);if(i)if("string"==typeof i)n.innerHTML=i;else if(Array.isArray(i))for(var l=0;l<i.length;l++)null!=i[l]&&n.appendChild(i[l]);return n},c=function(e,t){for(;e;e=e.parentNode)if(y(e.parentNode,t))return e};HTMLElement.prototype.tooltip=function(e){this.tooltipData=e,this.dispatchEvent(new Event("updatetooltip"))},"undefined"==typeof HTMLElement.prototype.requestFullScreen&&(HTMLElement.prototype.requestFullScreen=function(){this.webkitRequestFullscreen?this.webkitRequestFullscreen():this.mozRequestFullScreen?this.mozRequestFullScreen():this.msRequestFullscreen&&this.msRequestFullscreen()});var d=Object.keys(HTMLVideoElement.prototype);d.indexOf("webkitDecodedFrameCount")!=-1&&d.indexOf("getVideoPlaybackQuality")==-1&&(HTMLVideoElement.prototype.getVideoPlaybackQuality=function(){return{totalVideoFrames:this.webkitDecodedFrameCount,droppedVideoFrames:this.webkitDroppedFrameCount}}),"undefined"==typeof document.isFullScreen&&(document.isFullScreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenEnabled}),"undefined"==typeof document.exitFullscreen&&(document.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():window.msExitFullscreen&&msExitFullscreen()});var m=function(e,t){t=t||2;for(var i=""+e;i.length<t;)i="0"+i;return i},u=function(e,t){for(var i="",n=1;n<=t-(e+"").length;n++)i+="0";return i+e},p=function(e,t){if(0==e)return lang.oneDay;var i,n,a,o,l,s,r=new Date(1e3*parseInt(e));return i=String(r.getFullYear()),n=String(r.getMonth()+1),1==n.length&&(n="0"+n),a=String(r.getDate()),1==a.length&&(a="0"+a),o=String(r.getHours()),1==o.length&&(o="0"+o),l=String(r.getMinutes()),1==l.length&&(l="0"+l),s=String(r.getSeconds()),1==s.length&&(s="0"+s),t?String(n+"-"+a+" "+o+":"+l):String(i+"-"+n+"-"+a+" "+o+":"+l+":"+s)},v=function(e){return isNaN(e)?"00:00":u(parseInt(e/60),2)+":"+u(parseInt(e%60),2)},f=function(e){for(var t=e.split(":"),i=0,n=0;n<t.length;n++){i*=60;var a=parseInt(t[n]);if(isNaN(a)||a<0)return!1;i+=a}return i},g=function(e,a,o){if(e){e[n]("mousemove",function(t){var i,n=s("ABP-Tooltip"),l=e.clientWidth,d=e.clientHeight,m=e.getBoundingClientRect(),u=c(e,"ABP-Unit").parentNode,p=u.getBoundingClientRect(),v=m.top-p.top,f=a?t.clientX-p.left:m.left-p.left,g=f;null==n&&(n=r("div",{id:"ABP-Tooltip"},[r("text",e.tooltipData)]),n.by=e,u.appendChild(n),n.style.top=v+d+2+"px",n.style.left=f+l/2-n.clientWidth/2+"px",g+=l/2-n.clientWidth/2),a&&(n.style.left=f-n.clientWidth/2+"px",g-=l/2),i=n.getBoundingClientRect(),i.left<p.left?n.style.left="0px":i.right>p.right&&(n.style.left=p.width-i.width+"px"),o=o||-6,o&&(n.style.top=v-n.clientHeight+2+o+"px")});var l=function(){var e=s("ABP-Tooltip");e&&e.parentNode&&e.remove()},d=null;e[n]("mouseout",l),e[n]("touchend",function(){null!=d&&(i(d),d=null),d=t(function(){d=null,l()},2e3)}),e[n]("updatetooltip",function(t){var i=s("ABP-Tooltip");i&&i.by==t.target&&(i.textContent=e.tooltipData)})}},h=function(e,t){if(null!=e){var i=e.className.split(" ");""==i[0]&&(i=[]),i.indexOf(t)<0&&i.push(t),e.className=i.join(" ")}},y=function(e,t){if(null==e)return!1;var i=e.className.split(" ");return""==i[0]&&(i=[]),i.indexOf(t)>=0},b=function(e,t){if(null!=e){var i=e.className.split(" ");""==i[0]&&(i=[]),i.indexOf(t)>=0&&i.splice(i.indexOf(t),1),e.className=i.join(" ")}},S=function(e,t){var i={};for(var n in t)e&&"undefined"!=typeof e[n]?i[n]=e[n]:i[n]=t[n];return i};ABP.create=function(e,t){var i=e;if(t||(t={}),ABP.playerConfig=t.config?t.config:{},t=S(t,{replaceMode:!0,width:512,height:384,src:""}),"string"==typeof e&&(i=s(e)),y(i,"ABP-Unit"))n=i;else{var n=r("div",{className:"ABP-Unit",style:{width:t.width.toString().indexOf("%")>=0?t.width:t.width+"px",height:t.height.toString().indexOf("%")>=0?t.height:t.height+"px"}});i.appendChild(n)}n.children.length>0&&t.replaceMode&&(n.textContent="");var o=[],l=[];if("string"==typeof t.src)t.src=r("video",{autobuffer:"true",dataSetup:"{}"},[r("source",{src:t.src})]),o.push(t.src);else if(t.src.hasOwnProperty("playlist"))for(var c=t.src,d=c.playlist,m=0;m<d.length;m++){if(d[m].hasOwnProperty("sources")){var u=[];for(var p in d[m].sources)u.push(r("source",{src:d[m][p],type:p}));o.push(r("video",{autobuffer:"true",dataSetup:"{}"},u))}else d[m].hasOwnProperty("video")&&o.push(d[m].video);l.push(d[m].comments)}else o.push(t.src);n.appendChild(r("div",{className:"ABP-Player"},[r("div",{className:"ABP-Video",tabindex:"10"},[r("div",{id:"info-box",style:{opacity:1}},[r("div",{className:"text-wrapper"},[r("div",{},[r("text",ABP.Strings.loadingMeta)])]),r("div",{id:"dots"})]),r("div",{className:"ABP-Container"},[r("div",{className:"cmt",style:{left:0}},[r("text","　")])]),o[0],r("div",{className:"Player-Stats"},[r("div",{id:"player-dimension"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsPlayer)]),r("span")]),r("div",{id:"video-dimension"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsVideo)]),r("span")]),r("div",{id:"mimeType"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsMimetype)]),r("span")]),r("div",{id:"buffer-health"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsBuffer)]),r("span",{className:"stats-column",id:"buffer-health-column"}),r("span")]),r("div",{style:{position:"relative"}},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsBufferClip)]),r("span",{id:"buffer-clips"},[r("span"),r("span",{},[r("div",{style:{width:"1px",height:"400%",top:"-150%",position:"absolute",background:"#FFF",left:0}})])]),r("pre",{style:{position:"absolute",margin:0,left:"250px",width:"90px",fontFamily:"inherit"}})]),r("br",{className:"flvjs"}),r("div",{className:"flvjs"},[r("span",{className:"stats_name"},[r("text","fps：")]),r("span")]),r("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsVideoBitrate)]),r("span")]),r("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsAudioBitrate)]),r("span")]),r("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsCurrentBitrate)]),r("span")]),r("div",{title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.overallBitrate)]),r("span",{id:"overall-bitrate"})]),r("div",{className:"flvjs",style:{position:"relative"}},[r("div",{style:{position:"absolute",left:"240px",bottom:"100%",cursor:"pointer"},event:{click:function(e){e.stopPropagation(),flvplayer&&flvplayer.reloadSegment&&flvplayer.reloadSegment()}}},[r("text","[ "+ABP.Strings.reload+" ]")])]),r("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsRealtimeBitrate)]),r("span",{className:"stats-column",id:"realtime-bitrate-column",style:{verticalAlign:"top"}}),r("span")]),r("div",{className:"flvjs"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsDownloadSpeed)]),r("span",{className:"stats-column",id:"download-speed-column",style:{verticalAlign:"top"}}),r("span")]),r("div",{className:"flvjs"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsSourceHost)]),r("span",{className:"srcUrl"})]),r("div",{className:"flvjs"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsRedirection)]),r("span",{className:"redirUrl"})]),r("br"),r("div",{id:"canvas-fps"},[r("span",{className:"stats_name"},[r("text","Canvas fps：")]),r("span")]),r("div",{className:"videoQuality"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsPresent)]),,r("span",{className:"stats-column",id:"playback-fps-column"}),r("span")]),r("div",{className:"videoQuality"},[r("span",{className:"stats_name"},[r("text",ABP.Strings.statsDrop)]),,r("span",{className:"stats-column",id:"drop-fps-column"}),r("span")]),r("br"),r("div",{style:{fontSize:"11px"}},[r("text",a)]),r("div",{style:{fontSize:"11px"}},[r("text","2019©esterTion")]),r("div",{id:"stats-close"},[r("text","×")])]),r("div",{className:"Drag-Control"},[r("div",{className:"Drag-Icon"}),r("div",{className:"Drag-Speed"},[r("text","")]),r("div",{className:"Drag-Time"},[r("text","00:00╱00:00")]),r("div",{className:"Drag-Time-Bar"},[r("div",{className:"fill"})])])]),r("div",{className:"ABP-Bottom"},[r("div",{className:"ABP-Bottom-Extend"}),r("div",{className:"BiliPlus-Scale-Menu"},[r("div",{className:"Video-Defination"}),r("div",{className:"Video-Scale"},[r("div",{changeTo:"default",className:"on"},[r("text",ABP.Strings.displayScaleD)]),r("div",{changeTo:"16_9"},[r("text","16:9")]),r("div",{changeTo:"4_3"},[r("text","4:3")]),r("div",{changeTo:"full"},[r("text",ABP.Strings.displayScaleF)])])]),r("div",{className:"ABP-Bottom-Wrapper"},[r("div",{className:"ABP-Text"},[r("div",{className:"ABP-CommentStyle"},[r("div",{className:"button-group ABP-Comment-FontGroup"},[r("div",{className:"button ABP-Comment-Font icon-font-style"}),r("div",{className:"ABP-Comment-FontOption"},[r("p",{className:"style-title"},[r("text",ABP.Strings.sendSize)]),r("div",{className:"style-select",name:"commentFontSize"},[r("div",{className:"style-option",value:18},[r("text",ABP.Strings.sendSmall)]),r("div",{className:"style-option on",value:25},[r("text",ABP.Strings.sendMid)])]),r("p",{className:"style-title"},[r("text",ABP.Strings.sendMode)]),r("div",{className:"style-select",name:"commentMode"},[r("div",{className:"style-option",value:5},[r("text",ABP.Strings.sendTop)]),r("div",{className:"style-option on",value:1},[r("text",ABP.Strings.sendScroll)]),r("div",{className:"style-option",value:4},[r("text",ABP.Strings.sendBottom)])])])]),r("div",{className:"button-group ABP-Comment-ColorGroup"},[r("div",{className:"ABP-Comment-Color-Display"}),r("div",{className:"button ABP-Comment-Color icon-color-mode"}),r("div",{className:"ABP-Comment-ColorOption"},[r("div",{className:"ABP-Comment-ColorPicker"})])])]),r("form",{},[r("input",{className:"ABP-Comment-Input"})]),r("div",{className:"ABP-Comment-Send"},[r("text",ABP.Strings.send)])]),r("div",{className:"ABP-Control"},[r("div",{className:"button ABP-Play icon-play"}),r("div",{className:"button ABP-Next icon-next"},'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 12 12"><path d="M 2,12 8.5,7 2,2 z M 10,2 h 1.5 V 12 h -1.5 z"/></svg>'),r("div",{className:"progress-bar"},[r("div",{className:"bar"},[r("div",{className:"load"}),r("div",{className:"dark"})])]),r("div",{className:"time-label"},[r("text","00:00 / 00:00")]),r("div",{className:"button ABP-Volume icon-volume-high"}),r("div",{className:"volume-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("div",{className:"button-group ABP-CommentGroup"},[r("div",{className:"button ABP-CommentShow icon-comment on"})]),r("div",{className:"button-group ABP-PlaySpeedGroup"},[r("div",{className:"button ABP-Loop icon-loop"})]),r("div",{className:"button ABP-Setting icon-gear"}),r("div",{className:"button ABP-CommentListShow icon-list"},'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 15 12"><path d="M 1,1 h 3 v 2 h -3 v -2 z M 6,1 h 8 v 2 h -8 z M1,5 h 3 v 2 h -3 v -2 z M 6,5 h 8 v 2 h -8 z M 1,9 h 3 v 2 h -3 v -2 z M 6,9 h 8 v 2 h -8 z"/></svg>'),r("div",{className:"button-group ABP-FullScreenGroup"},[r("div",{className:"button ABP-FullScreen icon-screen-full"}),r("div",{className:"button ABP-Web-FullScreen icon-screen"})])])]),r("div",{className:"ABP-Title"})])])),n.appendChild(r("div",{className:"shield hidden"},[r("div",{className:"shield_top"},[r("text",ABP.Strings.commentBlock),r("span",{className:"close"})]),r("div",{className:"shield_tabs"},[r("div",{className:"shield_tab on"},[r("div",{},[r("text",ABP.Strings.shieldTypeText)])]),r("div",{className:"shield_tab"},[r("div",{},[r("text",ABP.Strings.shieldTypeUser)])]),r("div",{className:"shield_tab"},[r("div",{},[r("text",ABP.Strings.shieldTypeColor)])]),r("div",{className:"shield_tab"},[r("div",{},[r("text",ABP.Strings.shieldTypeSetting)])])]),r("div",{className:"shield_tab_slash"}),r("div",{className:"shield_body"},[r("div",{className:"shield_body_wrapper"},[r("div",{className:"shield_tab_body"},[r("div",{id:"shield_text"}),r("div",{className:"shield_item"},[r("input",{className:"new",type:"text",placeholder:ABP.Strings.shieldAdd}),r("div",{className:"add"})])]),r("div",{className:"shield_tab_body"},[r("div",{id:"shield_user"})]),r("div",{className:"shield_tab_body"},[r("div",{id:"shield_color"})]),r("div",{className:"shield_tab_body"},[r("div",{className:"shield_toggle",id:"useReg"},[r("text",ABP.Strings.shieldUseRegex)]),r("div",{className:"shield_toggle",id:"blockTop"},[r("text",ABP.Strings.shieldBlockTop)]),r("div",{className:"shield_toggle",id:"blockBottom"},[r("text",ABP.Strings.shieldBlockBottom)]),r("div",{className:"shield_toggle",id:"blockVisitor"},[r("text",ABP.Strings.shieldBlockVisitor)]),r("div",{className:"shield_slide",id:"repeat"},[r("div",{className:"fill"}),r("div",{className:"button"}),r("div",{className:"slide_info"})]),r("div",{style:{padding:"0 16px"}},[r("text",ABP.Strings.shieldRepeat)])])])])])),n.appendChild(r("div",{className:"ABP-Comment-List"},[r("div",{className:"ABP-Comment-List-Count"},[r("div",{style:{position:"absolute",right:"200px"}},[r("span",{id:"viewer",style:{fontWeight:"bold"}},[r("text","--")]),r("text",ABP.Strings.viewers)]),r("div",{style:{position:"absolute",right:"20px"}},[r("span",{id:"danmaku",style:{fontWeight:"bold"}},[r("text","--")]),r("text",ABP.Strings.comments)])]),r("div",{className:"ABP-Comment-List-Title"},[r("div",{className:"cmt-time",item:"time"},[r("text",ABP.Strings.commentTime)]),r("div",{className:"cmt-content",item:"content"},[r("text",ABP.Strings.commentContent)]),r("div",{className:"cmt-date",item:"date"},[r("text",ABP.Strings.commentDate)])]),r("div",{className:"ABP-Comment-List-Container"},[r("ul",{className:"ABP-Comment-List-Container-Inner"})])])),n.appendChild(r("div",{className:"ABP-Settings"},[r("div",{},[r("div",{className:"ABP-Settings-Top"},[r("div",{className:"ABP-Settings-Close"},[r("text","×")])]),r("div",{className:"ABP-Settings-Container"},[r("p",{className:"label big"},[r("text",ABP.Strings.settComment)]),r("p",{className:"label prop"},[r("text",ABP.Strings.useCSS),r("div",{className:"prop-checkbox"})]),r("p",{className:"label"},[r("text",ABP.Strings.commentSpeed)]),r("div",{className:"speed-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("p",{className:"label"},[r("text",ABP.Strings.commentScale)]),r("div",{className:"scale-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("p",{className:"label"},[r("text",ABP.Strings.commentDensity)]),r("div",{className:"density-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("p",{className:"label"},[r("text",ABP.Strings.commentOpacity),r("div",{className:"prop-checkbox",style:{top:"10px",left:"calc(100% - 20px)"}})]),r("div",{className:"opacity-bar",style:{width:"calc(100% - 25px)"}},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("p",{className:"label prop"},[r("text",ABP.Strings.cmStyle),r("select",{id:"setting-cmStyle",event:{mouseup:function(e){e.stopPropagation()}}},[r("option",{value:"0-1"},[r("text",ABP.Strings.cmStyle_st)]),r("option",{value:"1-0"},[r("text",ABP.Strings.cmStyle_sh)]),r("option",{value:"1-1"},[r("text",ABP.Strings.cmStyle_stsh)])])]),r("p",{className:"label prop"},[r("text",ABP.Strings.cmFont||"弹幕字体："),r("input",{id:"setting-cmFont",type:"text",style:{width:"90px"}}),r("input",{id:"setting-cmFont-apply",type:"button",value:"应用"})]),r("div",{className:"shield-enrty"},[r("text",ABP.Strings.commentBlock)]),r("p",{className:"label big"},[r("text",ABP.Strings.playSpeed)]),r("div",{className:"playSpeed-bar"},[r("div",{className:"bar"},[r("div",{className:"load"})])]),r("div",{className:"play-speed-reset"},[r("text",ABP.Strings.playSpeedReset)]),r("p",{className:"label prop"},[r("text",ABP.Strings.recordPlaySpeed),r("div",{id:"setting-recordPlaySpeed",className:"prop-checkbox"})]),r("p",{className:"label big"},[r("text",ABP.Strings.settPlayer)]),r("p",{className:"label prop"},[r("text",ABP.Strings.autoPlay),r("div",{id:"setting-autoPlay",className:"prop-checkbox"})]),r("p",{className:"label prop"},[r("text",ABP.Strings.defaultFull),r("div",{id:"setting-defaultFull",className:"prop-checkbox"})]),r("p",{className:"label prop"},[r("text",ABP.Strings.playerTheme),r("select",{id:"setting-playerTheme",event:{mouseup:function(e){e.stopPropagation()}}},[r("option",{value:"bilibili"},[r("text","BiliBili")]),r("option",{value:"YouTube"},[r("text","YouTube")])])]),r("p",{className:"label prop",style:{display:"none"},id:"setting-subtitles-group"},[r("text",ABP.Strings.mainSubtitle),r("select",{id:"setting-subtitles-primary",event:{mouseup:function(e){e.stopPropagation()}}},[r("option",{value:""},[r("text",ABP.Strings.subtitleClosed)])]),r("br"),r("text",ABP.Strings.secondarySubtitle),r("select",{id:"setting-subtitles-secondary",event:{mouseup:function(e){e.stopPropagation()}}},[r("option",{value:""},[r("text",ABP.Strings.subtitleClosed)])])])])])])),n.appendChild(r("div",{className:"Context-Menu"},[r("div",{className:"Context-Menu-Background"}),r("div",{className:"Context-Menu-Body"},[r("div",{id:"Player-Stats-Toggle",className:"preserve"},[r("text",ABP.Strings.showStats)]),r("div",{id:"Player-Screenshot",className:"dm preserve"},[r("div",{className:"content"},[r("text",ABP.Strings.screenshot)]),r("div",{className:"dmMenu"},[r("div",{"data-comment":"off"},[r("text",ABP.Strings.screenshotWithoutComment)]),r("div",{"data-comment":"on"},[r("text",ABP.Strings.screenshotWithComment)])])]),r("div",{id:"Player-Speed-Control",className:"dm preserve"},[r("div",{className:"content"},[r("text",ABP.Strings.playSpeed)]),r("div",{className:"dmMenu",style:{top:"-74px"}},[r("div",{"data-speed":.5},[r("text",.5)]),r("div",{"data-speed":.75},[r("text",.75)]),r("div",{"data-speed":1},[r("text",1)]),r("div",{"data-speed":1.25},[r("text",1.25)]),r("div",{"data-speed":1.5},[r("text",1.5)]),r("div",{"data-speed":1.75},[r("text",1.75)]),r("div",{"data-speed":2},[r("text",2)])])]),r("div",{className:"about preserve"},[r("text",a)])])])),n.appendChild(r("input",{class:"Copy-Text-Input",type:"text",style:{height:"1px",width:"1px",padding:0,border:0,pointerEvents:"none",opacity:0}}));var v=ABP.bind(n);return v};var C=function(){var e=3988292384,t=new Array(256),i=function(){var i,n,a;for(n=0;n<256;++n){for(i=n,a=0;a<8;++a)i=0!=(1&i)?e^i>>>1:i>>>1;t[n]=i}},n=function(e,i){for(var n,a=4294967295,o=e.length,l=0;l<o;++l)n=255&(a^e.charCodeAt(l)),a=a>>>8^t[n];return i?n:a},a=function(e){for(var i=0;i<256;i++)if(t[i]>>>24==e)return i;return-1},o="",l=function(e,i){var a=0,l="",s=n(e.toString(),!1);return a=255&s^i[2],a<=57&&a>=48?(l+=a-48,s=t[i[2]]^s>>>8,a=255&s^i[1],a<=57&&a>=48?(l+=a-48,s=t[i[1]]^s>>>8,a=255&s^i[0],a<=57&&a>=48?(l+=a-48,s=t[i[0]]^s>>>8,o=l,1):0):0):0};i();var s=new Array(4);return function(e){var i,r,c,d=4294967295^parseInt(e,16);for(r=1;r<1001;r++)if(d==n(r.toString(),!1))return r;for(r=3;r>=0;r--)s[3-r]=a(d>>>8*r),i=t[s[3-r]],d^=i>>>8*(3-r);for(r=0;r<5e6&&(c=n(r.toString(),!0),c!=s[3]||!l(r,s));r++);return 3e5==r?-1:r+""+o}},B=function(e){for(var t=0,i=e.buffered,n=i.length,a=0,o=e.currentTime;a<n&&!(o<i.start(a));a++)t=a;var l=i.start(t),s=i.end(t);return{start:l,end:s,delta:s-o,index:t}};window.crc_engine=new C,ABP.bind=function(a,o){function c(e,i){switch(e){case"close":case"error":Jt.removeListener(),t(function(){Jt=new Xt(window.cid),Jt.setListener(c)},1e3*Yt),console.warn("WebSocket断开，"+Yt+"秒后重连"),Yt<256&&(Yt<<=1);break;case"online":Yt=1,P.playerUnit.querySelector(".ABP-Comment-List-Count span#viewer").textContent=i;break;case"msg":case"msg_v2":if(i=JSON.parse(i),i.data&&i.data.room&&void 0!=i.data.room.online){Yt=1,P.playerUnit.querySelector(".ABP-Comment-List-Count span#viewer").textContent=i.data.room.online;break}if("msg_v2"==e&&(i={cmd:"DM",info:i}),"DM"==i.cmd){var n=i.info;n=[n[0].split(","),n[1]],n={border:!1,position:"absolute",stime:1e3*n[0][0],mode:1*n[0][1],size:1*n[0][2],color:1*n[0][3],date:1*n[0][4],whatTheHellIsThis:1*n[0][5],pool:1*n[0][6],hash:n[0][7],dbid:1*n[0][8],text:n[1]},8==n.mode&&(n.code=n.text,delete n.text);var a={date:n.date,time:n.stime,mode:n.mode,user:n.hash,pool:n.pool,content:n.text||n.code,originalData:n};P.cmManager.insert(n),shield.shield(),P.commentList[n.dbid]=a,P.commentObjArray.push(n.dbid);var o=P.commentListContainer,l=!1;o.parentNode.scrollTop+o.parentNode.offsetHeight==o.scrollHeight&&(l=!0),P.commentListContainer.style.height=24*P.commentObjArray.length+"px",P.renderCommentList(),l&&(o.parentNode.scrollTop+=24),P.playerUnit.querySelector(".ABP-Comment-List-Count span#danmaku").textContent=P.commentObjArray.length}}}function d(e,t){return e.map(function(e){return"\n"+u(e.from)+" --> "+u(e.to)+" line:-2\n<c."+t+">"+e.content+"</c>"})}function u(e){var t=Math.floor(e/60),i=Math.floor(t/60);return t%=60,e%=60,t<10&&(t="0"+t),i<10&&(i="0"+i),e=(e<10?"0":"")+e.toFixed(3),[i,t,e].join(":")}var C=function(e){P.video.currentTime=this.data.time/1e3,kt(A.currentTime)},P={playerUnit:a,btnPlay:null,btnNext:null,barTime:null,barLoad:null,barTimeHitArea:null,barVolume:null,barVolumeHitArea:null,barOpacity:null,barOpacityHitArea:null,barScale:null,barScaleHitArea:null,barSpeed:null,barSpeedHitArea:null,barPlaySpeed:null,barPlaySpeedHitArea:null,btnFont:null,btnColor:null,btnSend:null,controlBar:null,timeLabel:null,timeJump:null,divComment:null,btnWide:null,btnFull:null,btnWebFull:null,btnDm:null,btnLoop:null,btnProp:null,btnAutoOpacity:null,videoDiv:null,btnVolume:null,video:null,txtText:null,commentColor:"ffffff",commentFontSize:25,commentMode:1,displayColor:null,cmManager:null,commentList:null,commentListContainer:null,commentObjMap:{},lastSelectedComment:null,commentCoolDown:1e4,commentScale:ABP.playerConfig.scale?ABP.playerConfig.scale:1,commentSpeed:ABP.playerConfig.speed?ABP.playerConfig.speed:1,proportionalScale:ABP.playerConfig.prop,autoPlay:!1,defaultFull:!1,recordPlaySpeed:!1,defaults:{w:0,h:0},inited:!1,state:S(o,{fullscreen:!1,commentVisible:!0,allowRescale:!1,autosize:!1,widescreen:!1,commentListShow:!1,settingsShow:!1}),createPopup:function(e,i){(0|i)<=0&&(i=5e3);var n=r("div",{className:"ABP-Popup"},[r("text",e)]);n.bottom=0,a.appendChild(n),"number"==typeof i&&t(function(){n.remove()},i);for(var o=a.getElementsByClassName("ABP-Popup"),l=0;l<o.length;l++)o[l]!=n&&(o[l].bottom+=n.offsetHeight+10,o[l].style.transform="translateY(-"+o[l].bottom+"px)");return n},removePopup:function(){for(var e=a.getElementsByClassName("ABP-Popup"),t=e.length-1;t>=0;t--)e[t].remove()},loadCommentList:function(e,t){t="asc"==t?-1:1;var i=Object.keys(P.commentList).sort(function(i,n){return P.commentList[i][e]<P.commentList[n][e]?t:P.commentList[i][e]>P.commentList[n][e]?-t:0});P.commentObjArray=i,P.commentListContainer.style.height=24*P.commentObjArray.length+"px",P.renderCommentList(),P.playerUnit.querySelector(".ABP-Comment-List-Count span#danmaku").textContent=P.commentObjArray.length},renderCommentList:function(){if(P.commentObjArray){var e=P.commentListContainer.parentElement.scrollTop,t=parseInt(e/24);P.commentListContainer.textContent="";for(var i=t;i<=t+40;i++){var n=P.commentObjArray[i];if("undefined"==typeof P.commentList[n])break;var a=P.commentList[n];if(a&&a.time){if(P.commentObjMap[n])var o=P.commentObjMap[n],l=o.children[0];else{var l=r("span",{className:"cmt-time"},[r("text",v(a.time/1e3))]),s=r("span",{className:"cmt-content"},[r("text",a.content)]),c=r("span",{className:"cmt-date"},[r("text",p(a.date,!0))]),o=r("li",{event:{dblclick:C}},[l,s,c]);g(s,!1,36),g(c,!1,18),s.tooltip(a.content),c.tooltip(p(a.date)),o.data=a,o.originalData=a.originalData,8==a.mode?o.style.background="#ffe100":0!=a.pool&&(o.style.background="#20ff20"),P.commentObjMap[n]=o}i==t&&i>0?o.style.paddingTop=24*t+"px":o.style.paddingTop&&(o.style.paddingTop=""),a.originalData.isBlocked?(l.className="cmt-time blocked",l.title=ABP.Strings.blockMatch+a.originalData.blockReason):(l.className="cmt-time",l.title=""),P.commentListContainer.appendChild(o)}}}},commentCallback:function(e){e.result?(P.commentList[e.id]=P.commentList[e.tmp_id],delete P.commentList[e.tmp_id]):(delete P.commentList[e.tmp_id],P.createPopup(e.error,5e3))},swapVideo:null};if(P.copyText=function(e){try{var t=P.playerUnit.querySelector(".Copy-Text-Input");t.value=e,t.select();var i=document.execCommand("copy");if(t.blur(),!i)throw"";P.createPopup(ABP.Strings.copied,1e3)}catch(e){console.error(e),P.createPopup(ABP.Strings.copyFail,3e3)}},Object.defineProperty(P,"title",{get:function(){return P.playerUnit.getElementsByClassName("ABP-Title")[0].textContent},set:function(e){var t=P.playerUnit.getElementsByClassName("ABP-Title")[0];t.textContent="",t.appendChild(r("text",e))}}),P.swapVideo=function(e){var i=function(){if(!Pt){kt(e.currentTime);try{var t=B(this),i=this.duration,n=t.end/i*100;P.barLoad.style.width=n+"%"}catch(e){return}}};e[n]("timeupdate",i),e[n]("timeupdate",function t(i){e.removeEventListener("timeupdate",t),P.inited=!0}),e[n]("canplay",function t(i){e.removeEventListener("timeupdate",t),P.inited=!0});var o=0,l=!0,s=!1,c=!1,d=!1,m=function(){d=!1,e.removeEventListener("canplay",m),void 0!=P.lastTime&&(e.currentTime=P.lastTime,delete P.lastTime),void 0!=P.lastSpeed&&(e.playbackRate=P.lastSpeed,delete P.lastSpeed),!e.paused||!P.autoPlay&&l||(P.btnPlay.click(),document.getElementById("info-box").style.opacity=0,dots.stopTimer(),u=!1),l&&(l=!1,!P.state.fullscreen&&P.defaultFull&&P.btnWebFull.click())},u=!0,p=!1,v=function(){var t=e.readyState,i=document.getElementById("info-box");if(!e.ended)switch(t){case 1:case 2:var n,a=e.buffered;try{if(n=B(e),flvplayer&&flvplayer._mediaDataSource&&n.delta<.2&&n.index<a.length-1)return console.warn("buffer gap at",a.end(n.index),", jump from",e.currentTime,"to",a.start(n.index+1)),void(e.currentTime=a.start(n.index+1))}catch(e){}if(void 0!=n&&n.delta>.5*e.playbackRate)return;u||(p=!e.paused,u=!0,p&&e.pause()),0==i.style.opacity&&(i.style.opacity=1),dots.running||dots.runTimer();try{i.childNodes[0].childNodes[0].textContent=ABP.Strings.buffering+" "+n.delta.toFixed(2)+"s"}catch(e){i.childNodes[0].childNodes[0].textContent=ABP.Strings.buffering}break;case 3:case 4:if(u){var n=B(e);n.delta>5||e.duration-n.end<5?1==i.style.opacity&&(i.style.opacity=0,dots.stopTimer(),u=!1,p&&e.play()):i.childNodes[0].childNodes[0].textContent=ABP.Strings.buffering+" "+n.delta.toFixed(2)+"s"}}},f=function(){if(window.cid&&!s&&!c&&!d){var t=JSON.parse(localStorage.playHistory||"{}");t[cid]=0|e.currentTime,localStorage.playHistory=JSON.stringify(t)}},g=function(){if(window.cid){var e=JSON.parse(localStorage.playHistory||"{}");e[cid]&&delete e[cid],localStorage.playHistory=JSON.stringify(e)}};e[n]("autoplay",function(){e[n]("canplay",m)}),e[n]("pause",f),e[n]("ended",function(){s=!0,g()});try{var y=JSON.parse(localStorage.playHistory||"{}");void 0!=y[cid]&&(P.lastTime=y[cid])}catch(e){}window[n]("beforeunload",function(){f(),P.inited=!1}),window[n]("unload",function(){P.inited=!1}),a[n]("beforecidchange",function(){f(),d=!0,s=!1}),e[n]("loop",function(){c=e.loop}),e[n]("canplay",m),e[n]("canplay",v),e[n]("waiting",v),e[n]("readystatechange",v),e[n]("progress",v),e[n]("ended",function(){if(P.btnPlay.className="button ABP-Play icon-play",P.videoDiv.className="ABP-Video",P.playerUnit.classList.contains("has-next")){var e,t,i,o=5,l=function(){a.removeEventListener("callNext",l),e.remove(),clearInterval(i)};e=a.appendChild(r("div",{className:"ABP-Popup"},[r("text","将在 "),t=r("span",{},[r("text","5")]),r("text"," 秒后播放 "+P.btnNext.tooltipData.substr(ABP.Strings.next.length)+" "),r("a",{style:{color:"#1e90ff",cursor:"pointer"},event:{click:l}},[r("text","取消")])])),i=setInterval(function(){return--o?void(t.textContent=o):a.dispatchEvent(new Event("callNext"))},1e3),a[n]("callNext",l)}}),e[n]("progress",i),e.isBound=!0;var S=0,C=!1;if(P.cmManager){P.cmManager[n]("load",function(){P.commentList={};for(N in P.cmManager.timeline){var e=P.cmManager.timeline[N];8!=e.mode||C||(C=!0,t(function(){var e=new CCLScripting("/js/CommentCoreLibraryScripting.min.js");P.cmManager.scripting=e.getSandbox(P.divComment,P.video)},0)),e.dbid&&void 0!=e.stime&&(P.commentList[e.dbid]={date:e.date,time:e.stime,mode:e.mode,user:e.hash,pool:e.pool,content:e.text||e.code,originalData:e})}P.loadCommentList("date","asc"),P.commentListContainer.parentElement[n]("scroll",P.renderCommentList)}),P.cmManager.setBounds=function(){a.offsetHeight<=300||a.offsetWidth<=700?h(a,"ABP-Mini"):b(a,"ABP-Mini");var e=P.videoDiv.offsetWidth,t=P.videoDiv.offsetHeight;P.proportionalScale?t/493*P.commentScale:P.commentScale;this.width=e,this.height=t,this.options.global.scale=this.width/680/P.commentSpeed,this.dispatchEvent("resize");for(var i in this.csa)this.csa[i].setBounds(this.width,this.height);this.stage.style.width=this.width+"px",this.stage.style.height=this.height+"px",this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px",a.querySelector(".BiliPlus-Scale-Menu .Video-Scale div.on").click(),this.canvasResize()},t(function(){P.cmManager.setBounds()},0),P.cmManager.clear(),e[n]("progress",function(){S==e.currentTime&&x&&(new Date).getTime()-o>=100?(e.hasStalled=!0,P.cmManager.stopTimer(),P.cmManager.pauseComment()):S!=e.currentTime&&(S=e.currentTime),o=(new Date).getTime()}),window&&window[n]("resize",function(){P.cmManager.setBounds()}),e[n]("timeupdate",function(){P.cmManager.display!==!1&&(e.hasStalled&&(P.cmManager.startTimer(),P.cmManager.resumeComment(),e.hasStalled=!1),P.cmManager.time(Math.floor(1e3*e.currentTime)))}),e[n]("play",function(){P.cmManager.startTimer(),P.cmManager.resumeComment(),P.btnPlay.className="button ABP-Play ABP-Pause icon-pause",P.btnPlay.tooltip(ABP.Strings.pause),h(P.videoDiv,"ABP-HideCursor"),P.playerUnit.dispatchEvent(new Event("HideCursor"))}),e[n]("ratechange",function(){0!==e.playbackRate&&(P.recordPlaySpeed&&Ct(),jt(P.video.playbackRate))}),e[n]("durationchange",function(){if(0==e.duration){console.log("duration changed to 0, probably error"),P.createPopup("Playback crashed, reloading video");var t=e.currentTime;e.src=e.src,e.play();var i=function(){console.log("restored playback to",t),e.removeEventListener("canplay",i),e.currentTime=t};e[n]("canplay",i)}});var x=!1;e[n]("pause",function(){P.cmManager.stopTimer(),P.cmManager.pauseComment(),P.btnPlay.className="button ABP-Play icon-play",
P.btnPlay.tooltip(ABP.Strings.play),x=!1,b(P.videoDiv,"ABP-HideCursor"),P.playerUnit.dispatchEvent(new Event("HideCursor"))}),e[n]("waiting",function(){P.cmManager.stopTimer(),P.cmManager.pauseComment(),x=!1}),e[n]("playing",function(){P.cmManager.startTimer(),P.cmManager.resumeComment(),x=!0})}},null!==a&&null!==a.getElementsByClassName){P.defaults.w=a.offsetWidth,P.defaults.h=a.offsetHeight;var x=a.getElementsByClassName("ABP-Video");if(!(x.length<=0)){var A=null;P.videoDiv=x[0];for(var N in x[0].children)if(null!=x[0].children[N].tagName&&"VIDEO"===x[0].children[N].tagName.toUpperCase()){A=x[0].children[N];break}var k=x[0].getElementsByClassName("ABP-Container");if(k.length>0&&(P.divComment=k[0]),null!==A){P.video=A,P.video.seek=function(e){this.currentTime=parseFloat(e)/1e3};var w=a.getElementsByClassName("ABP-Play");if(!(w.length<=0)){P.btnPlay=w[0],P.btnPlay.tooltip(ABP.Strings.play),g(P.btnPlay);var M=a.getElementsByClassName("ABP-Next");if(!(M.length<=0)){P.btnNext=M[0],P.btnNext.tooltip(ABP.Strings.next),g(P.btnNext),P.btnNext[n]("click",function(e){e.stopPropagation(),a.dispatchEvent(new Event("callNext"))});var T=a.getElementsByClassName("progress-bar");if(!(T.length<=0)){var _=T[0].getElementsByClassName("bar");P.barTimeHitArea=_[0],P.barLoad=_[0].getElementsByClassName("load")[0],P.barTime=_[0].getElementsByClassName("dark")[0];var L=a.getElementsByClassName("time-label");if(!(L.length<=0)){P.timeLabel=L[0];var H=a.getElementsByClassName("ABP-Volume");if(!(H.length<=0)){P.btnVolume=H[0],P.btnVolume.tooltip(ABP.Strings.mute),g(P.btnVolume);var E=a.getElementsByClassName("volume-bar");if(!(E.length<=0)){var F=E[0].getElementsByClassName("bar");P.barVolumeHitArea=F[0],P.barVolume=F[0].getElementsByClassName("load")[0];var D=a.getElementsByClassName("opacity-bar");if(!(D.length<=0)){var D=D[0].getElementsByClassName("bar");P.barOpacityHitArea=D[0],P.barOpacity=D[0].getElementsByClassName("load")[0];var I=a.getElementsByClassName("scale-bar");if(!(I.length<=0)){var I=I[0].getElementsByClassName("bar");P.barScaleHitArea=I[0],P.barScale=I[0].getElementsByClassName("load")[0],P.barDensityHitArea=a.querySelector(".density-bar .bar"),P.barDensity=P.barDensityHitArea.getElementsByClassName("load")[0];var O=a.getElementsByClassName("speed-bar");if(!(O.length<=0)){var O=O[0].getElementsByClassName("bar");P.barSpeedHitArea=O[0],P.barSpeed=O[0].getElementsByClassName("load")[0];var R=a.getElementsByClassName("playSpeed-bar");if(!(R.length<=0)){var R=R[0].getElementsByClassName("bar");P.barPlaySpeedHitArea=R[0],P.barPlaySpeed=R[0].getElementsByClassName("load")[0],a.querySelector(".play-speed-reset")[n]("click",function(){P.video.playbackRate=1});var U=a.getElementsByClassName("prop-checkbox");if(!(U.length<=0)){P.btnAutoOpacity=U[1],P.btnAutoOpacity.tooltip(ABP.Strings.autoOpacityOff),g(P.btnAutoOpacity),P.btnProp=U[0],P.btnProp.tooltip(ABP.Strings.usingCanvas),g(P.btnProp);var V=a.getElementsByClassName("ABP-FullScreen");if(!(V.length<=0)){P.btnFull=V[0],P.btnFull.tooltip(ABP.Strings.fullScreen),g(P.btnFull);var q=a.getElementsByClassName("ABP-Web-FullScreen");if(!(q.length<=0)){P.btnWebFull=q[0],P.btnWebFull.tooltip(ABP.Strings.webFull),g(P.btnWebFull);var j=a.getElementsByClassName("ABP-CommentListShow");if(!(j.length<=0)){P.btnCmtListShow=j[0],P.btnCmtListShow.tooltip(ABP.Strings.cmtListShow),g(P.btnCmtListShow);var z=a.getElementsByClassName("ABP-Comment-Font");if(!(z.length<=0)){P.btnFont=z[0],P.btnFont.tooltip(ABP.Strings.sendStyle),g(P.btnFont);var W=a.getElementsByClassName("ABP-Comment-Color");if(!(W.length<=0)){P.btnColor=W[0],P.btnColor.tooltip(ABP.Strings.sendColor),g(P.btnColor);var X=a.getElementsByClassName("ABP-Comment-Color-Display");if(!(X.length<=0)){P.displayColor=X[0];var J=a.getElementsByClassName("ABP-Comment-Input");if(!(J.length<=0)){P.txtText=J[0];var Y=a.getElementsByClassName("ABP-Comment-List-Container-Inner");if(!(Y.length<=0)){P.commentListContainer=Y[0];var G=a.getElementsByClassName("ABP-Comment-Send");if(!(G.length<=0)){P.btnSend=G[0],P.btnSend.tooltip(ABP.Strings.sendTooltip),g(P.btnSend);var Q=a.getElementsByClassName("ABP-Control");Q.length>0&&(P.controlBar=Q[0]);var K=a.getElementsByClassName("ABP-CommentShow");if(!(K.length<=0)){P.btnDm=K[0],P.btnDm.tooltip(ABP.Strings.hideComment),g(P.btnDm);var Z=a.getElementsByClassName("ABP-Loop");if(!(Z.length<=0)){P.btnLoop=Z[0],P.btnLoop.tooltip(ABP.Strings.loopOff),g(P.btnLoop);var $=a.getElementsByClassName("ABP-Setting")[0],ee=a.getElementsByClassName("ABP-Settings")[0];P.btnSetting=$,P.settingPanel=ee,P.btnSetting.tooltip(ABP.Strings.settings),g(P.btnSetting);var te=!1,ie=function(){te?b(ee,"expand"):h(ee,"expand"),te?b($,"on"):h($,"on"),!te&&P.state.commentListShow&&P.btnCmtListShow.click(),te=!te,P.state.settingsShow=te};P.btnSetting[n]("click",ie),a.getElementsByClassName("ABP-Settings-Close")[0][n]("click",ie),document.getElementById("setting-autoPlay")[n]("click",function(){P.autoPlay=!P.autoPlay,P.autoPlay?h(this,"on"):b(this,"on"),Ct()}),document.getElementById("setting-defaultFull")[n]("click",function(){P.defaultFull=!P.defaultFull,P.defaultFull?h(this,"on"):b(this,"on"),Ct()}),document.getElementById("setting-recordPlaySpeed")[n]("click",function(){P.recordPlaySpeed=!P.recordPlaySpeed,P.recordPlaySpeed?h(this,"on"):b(this,"on"),Ct()});var ne={videoDimension:!0,videoQuality:!0,flvjs:!0},ae=function(e){return document.querySelector(e)},oe=function(e){return document.getElementById(e)},le=function(e){return(1*e).toFixed(2)},se=oe("player-dimension").lastChild,re=oe("video-dimension").lastChild,ce=oe("canvas-fps").lastChild,de=oe("buffer-health-column"),me=oe("realtime-bitrate-column"),ue=oe("download-speed-column"),pe=oe("playback-fps-column"),ve=pe.parentNode.lastChild,fe=oe("drop-fps-column"),ge=fe.parentNode.lastChild,he=[],ye=[],be=[],Se=[],Ce=0,Be=0,Pe=oe("buffer-health").lastChild,xe='<svg style="width:180px;height:21px"><polyline style="fill:transparent;stroke:#ccc"></polyline><polyline points="1,21 180,21 180,1" style="fill:transparent;stroke:#fff"></polyline></svg>',Ae="",Ne=r("style"),ke=r("style"),we=document.querySelectorAll(".flvjs>:last-child"),N=0,Me=function(e,t){var i,n=0,a=[];t.forEach(function(e){n=e>n?e:n}),0==n&&(n=1);for(i in t)a.push(3*i+","+(20*(1-t[i]/n)+1)+" "+(3*i+3)+","+(20*(1-t[i]/n)+1));e.setAttribute("points",a.join(" "))},Te=!1,_e=oe("Player-Stats-Toggle"),Le=function(e){"stats-close"==e.target.id&&e.stopPropagation(),ae(".Player-Stats").style.display=Te?"":"block",Te=!Te},He=0;for(_e[n]("click",Le),oe("stats-close")[n]("click",Le);N<60;N++)he.push(0),ye.push(0),be.push(0),Se.push(0);de.innerHTML=xe,de=de.firstChild.firstChild,me.innerHTML=xe,me.firstChild.lastChild.setAttribute("points","1,21 180,21 60,22 60,1"),me=me.firstChild.firstChild,ue.innerHTML=xe,ue=ue.firstChild.firstChild,pe.innerHTML=xe,pe=pe.firstChild.firstChild,fe.innerHTML=xe,fe=fe.firstChild.firstChild,void 0==A.videoWidth&&(ne.videoDimension=!1,Ae+="#video-dimension{display:none}"),void 0==A.getVideoPlaybackQuality&&(ne.videoQuality=!1,Ae+=".videoQuality{display:none}"),Ne.textContent=Ae,document.head.appendChild(Ne),ke.textContent=".flvjs{display:none}",document.head.appendChild(ke),void 0==window.flvplayer&&(ne.flvjs=!1);var Ee=function(){P.copyText(this.title)};if(P.playerUnit.querySelector(".srcUrl").contextActionName=ABP.Strings.copySegUrl,P.playerUnit.querySelector(".srcUrl").contextMenuAction=Ee,P.playerUnit.querySelector(".redirUrl").contextActionName=ABP.Strings.copySegUrl,setInterval(function(){He^=1,se.textContent=A.offsetWidth+"x"+A.offsetHeight+" *"+devicePixelRatio,ne.videoDimension&&(re.textContent=A.videoWidth+"x"+A.videoHeight);var e={};try{e=B(A)}catch(e){}if(e=e.delta>0?e.delta:0,he.push(e),he.shift(),Pe.textContent=le(e)+"s",Te&&Me(de,he),Te){for(var t,i,n=A.buffered,a=ae("#buffer-clips>span"),o=A.duration==1/0?n.end(n.length-1):A.duration,l=[],s=0;s<n.length;s++)s>=a.childNodes.length&&a.appendChild(r("span",{className:"buffer-clip"})),t=n.start(s),i=n.end(s)-t,a.childNodes[s].style.left=le(t/o*100)+"%",a.childNodes[s].style.width=le(i/o*100)+"%",l.push(v(0|t)+" - "+v(t+i|0));for(;s<a.childNodes.length;)a.childNodes[s].remove();a.parentNode.parentNode.childNodes[2].textContent=l.join("\n"),ae("#buffer-clips>span>div").style.left=le(A.currentTime/o*100)+"%"}if(ne.flvjs)if(flvplayer._mediaInfo){ke.textContent="";var c,d,s=0,m=flvplayer._mediaInfo,u=flvplayer.statisticsInfo,p=A.currentTime,f=flvplayer._mediaDataSource.segments,g=0,h=0;for(d=0;d<f.length;d++){if(p<=(g+f[d].duration)/1e3){g=p-g/1e3|0;break}g+=f[d].duration,h++}if(Te){for(var y=ae("#buffer-clips>span:nth-of-type(2)"),b=y.children;b.length>f.length;)b[f.length].remove();for(;b.length<f.length;)y.appendChild(r("div",{style:{width:"1px",height:"300%",top:"-100%",position:"absolute",background:"#CCC",left:0}}));for(var S=1,C=0;S<f.length;S++)b[S].style.left=le((C+f[S-1].duration)/1e3/o*100)+"%",C+=f[S-1].duration}var x=u.currentSegmentIndex,N=f[x]||{},k=N.filesize,w=N.duration;if(oe("mimeType").lastChild.textContent=m.mimeType,we[s++].textContent=le(m.fps),we[s++].textContent=le(m.videoDataRate)+" kbps",we[s++].textContent=le(m.audioDataRate)+" kbps",we[s++].textContent=le(k/w*8)+" kbps"+("　Seg "+(x+1)+"/"+u.totalSegmentCount),s++,m.bitrateMap){var M=m.bitrateMap;if(M[h]&&(c=M[h][g]),void 0!=c?we[s++].textContent=le(c)+" kbps":we[s++].textContent="N/A",Te){for(var T=[],_=h,L=g-20;L<0;){if(_--,!M[_]){_++;break}L+=M[_].length}for(;T.length<60;)void 0!=M[_]?(T.push(M[_][L]||0),L++,L>=M[_].length&&(_++,L=0)):T.push(0);Me(me,T)}}else we[s++].textContent="N/A";He?("number"==typeof u.speed&&(ye.push(u.speed),ye.shift()),Te&&Me(ue,ye),we[s++].textContent=le(u.speed)+" KB/s",flvplayer._statisticsInfo.speed=0):s++;var H,E,F=(N.url||"").match(/(http[s]?:)?\/\/([a-zA-Z0-9\.\-]+)/);null==F?(E=location.protocol,H=location.hostname):(E=F[1]||location.protocol,H=F[2]),we[s].title=N.url,we[s++].textContent=E+"//"+H,u.hasRedirect?(we[s].contextMenuAction=Ee,we[s].title=u.redirectedURL,we[s++].textContent=u.redirectedURL.match(/(http[s]?:)?\/\/([a-zA-Z0-9\.\-]+)/)[0]):(we[s].contextMenuAction=void 0,we[s++].textContent=ABP.Strings.statsRedirectionNone)}else{ke.textContent=".flvjs{display:none}",oe("mimeType").lastChild.textContent="video/mp4";for(var b=ae("#buffer-clips>span:nth-of-type(2)").children;b.length>1;)b[1].remove()}if(window.overallBitrate?(oe("overall-bitrate").parentNode.style.display="",oe("overall-bitrate").textContent=le(overallBitrate)+" kbps"):oe("overall-bitrate").parentNode.style.display="none",He&&(ce.textContent=P.cmManager.canvasFPS),He&&ne.videoQuality){var D=A.getVideoPlaybackQuality();Ce>D.totalVideoFrames&&(Ce=0),Be>D.droppedVideoFrames&&(Be=0);var I=D.totalVideoFrames-Ce,O=D.droppedVideoFrames-Be;Ce=D.totalVideoFrames,Be=D.droppedVideoFrames,be.push(I),be.shift(),Se.push(O),Se.shift(),Te&&(Me(pe,be),Me(fe,Se)),ve.textContent=I+" fps",ge.textContent=O+" fps "+(O/I*100).toFixed(2)+"%"}},500),"undefined"!=typeof CommentManager&&(P.cmManager=new CommentManager(P.divComment),P.cmManager.display=!0,P.cmManager.init(),P.cmManager.clear(),P.cmManager.filter.addModifier(shield.filter),window&&window[n]("resize",function(){P.cmManager.setBounds()})),"object"==typeof ABP.playerConfig){ABP.playerConfig.volume&&(P.video.volume=ABP.playerConfig.volume),ABP.playerConfig.opacity&&(P.cmManager.options.global.opacity=ABP.playerConfig.opacity),ABP.playerConfig.autoPlay&&(P.autoPlay=!0,h(document.getElementById("setting-autoPlay"),"on")),ABP.playerConfig.defaultFull&&(P.defaultFull=!0,h(document.getElementById("setting-defaultFull"),"on")),ABP.playerConfig.commentVisible===!1&&(h(P.playerUnit,"hide-comment"),b(P.btnDm,"on"),P.cmManager.display=!1,P.cmManager.stopTimer(),P.btnDm.tooltip(ABP.Strings.showComment)),ABP.playerConfig.useCSS&&(h(P.btnProp,"on"),P.cmManager.useCSS(!0),P.btnProp.tooltip(ABP.Strings.usingCSS)),ABP.playerConfig.autoOpacity&&(h(P.btnAutoOpacity,"on"),P.cmManager.autoOpacity(!0),P.btnAutoOpacity.tooltip(ABP.Strings.autoOpacityOn)),ABP.playerConfig.recordPlaySpeed&&(P.recordPlaySpeed=!0,h(document.getElementById("setting-recordPlaySpeed"),"on"),P.lastSpeed=ABP.playerConfig.playSpeed);var Fe=ABP.playerConfig.density||0;P.cmManager.options.global.density=Fe;var De=ABP.playerConfig.theme||"YouTube";a.setAttribute("theme",De),(ae("#setting-playerTheme [value="+De+"]")||{}).selected=!0,document.getElementById("setting-playerTheme")[n]("change",function(){a.setAttribute("theme",this.value),Ct(),a.dispatchEvent(new Event("themeChange"))});var Ie=ABP.playerConfig.cmStyle||"1-0";(ae('#setting-cmStyle [value="'+Ie+'"]')||{}).selected=!0,document.getElementById("setting-cmStyle")[n]("change",function(){var e=this.value.split("-");P.cmManager.options.global.shadow=1==e[0],P.cmManager.options.global.outline=1==e[1],Ct&&Ct()}),document.getElementById("setting-cmStyle").dispatchEvent(new Event("change"))}if(e(".ABP-Comment-List-Title *").click(function(){var t=e(this).attr("item"),i=e(this).hasClass("asc")?"desc":"asc";e(".ABP-Comment-List-Title *").removeClass("asc").removeClass("desc"),e(this).addClass(i),P.loadCommentList(t,i)}),e(".ABP-Unit .ABP-CommentStyle .ABP-Comment-FontOption .style-option").click(function(){e(this).closest(".style-select").find(".style-option").removeClass("on"),e(this).addClass("on"),P[e(this).closest(".style-select").attr("name")]=parseInt(e(this).attr("value"))}),e(a).find(".ABP-Comment-ColorPicker").colpick({flat:!0,submit:0,color:"ffffff",onChange:function(e,t){P.commentColor=t,P.displayColor.style.backgroundColor="#"+t}}),A.isBound!==!0){P.swapVideo(A),P.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Defination")[n]("click",function(e){if(!e.target.hasAttribute("changeto"))return!1;var t=JSON.parse(e.target.getAttribute("changeto"));changeSrc({target:{value:t[1]}},t[0]),b(e.target.parentNode.querySelector(".on"),"on"),h(e.target,"on")}),P.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Scale")[n]("click",function(e){if(!e.target.hasAttribute("changeto"))return!1;switch(e.target.getAttribute("changeto")){case"default":y(P.video,"scale")&&b(P.video,"scale"),P.video.style.width="",P.video.style.height="",P.video.style.paddingTop="",P.video.style.paddingLeft="";break;case"16_9":h(P.video,"scale");var t=P.videoDiv.offsetWidth,i=P.videoDiv.offsetHeight,n="",a="";t<i/9*16?(n=(i-t/16*9)/2+"px",i=t/16*9/i*100+"%",t="100%"):(a=(t-i/9*16)/2+"px",t=i/9*16/t*100+"%",i="100%"),P.video.style.width=t,P.video.style.height=i,P.video.style.paddingTop=n,P.video.style.paddingLeft=a;break;case"4_3":h(P.video,"scale");var t=P.videoDiv.offsetWidth,i=P.videoDiv.offsetHeight,n="",a="";t<i/3*4?(n=(i-t/4*3)/2+"px",i=t/4*3/i*100+"%",t="100%"):(a=(t-i/3*4)/2+"px",t=i/3*4/t*100+"%",i="100%"),P.video.style.width=t,P.video.style.height=i,P.video.style.paddingTop=n,P.video.style.paddingLeft=a;break;case"full":h(P.video,"scale"),P.video.style.width="",P.video.style.height="",P.video.style.paddingTop="",P.video.style.paddingLeft=""}b(e.target.parentNode.querySelector(".on"),"on"),h(e.target,"on")});var Oe,Re=0,Ue=!0,Ve=function(e){var n=Date.now();n-Re<=500?(P.btnFull.click(),n-Re<=200?i(Oe):P.btnPlay.click(),Re=0):(Re=n,Ue?(P.btnPlay.click(),Ue=!1):Oe=t(function(){P.btnPlay.click()},250)),e.preventDefault()};P.video[n]("timeupdate",function e(){this.paused||(P.video.removeEventListener("timeupdate",e),Ue=!1)}),P.videoDiv[n]("click",Ve),P.playerUnit.querySelector(".ABP-Bottom-Extend")[n]("click",function(e){e.preventDefault(),e.stopPropagation(),Ve(e)});var qe=t(function(){h(P.videoDiv,"ABP-HideCursor"),P.playerUnit.dispatchEvent(new Event("HideCursor"))},3e3);P.videoDiv[n]("mousemove",function(e){l(e)&&(qe&&i(qe),y(P.videoDiv,"ABP-HideCursor")&&(b(P.videoDiv,"ABP-HideCursor"),P.playerUnit.dispatchEvent(new Event("HideCursor"))),qe=t(function(){h(P.videoDiv,"ABP-HideCursor"),P.playerUnit.dispatchEvent(new Event("HideCursor"))},3e3))}),P.btnVolume[n]("click",function(){if(0==P.video.muted){if(P.video.muted=!0,0==P.video.muted)return void this.tooltip(ABP.Strings.muteNotSupported);this.className="button ABP-Volume icon-volume-mute2",this.tooltip(ABP.Strings.unmute),P.barVolume.style.width="0%"}else P.video.muted=!1,this.className="button ABP-Volume icon-volume-",P.video.volume<.1?this.className+="mute":P.video.volume<.33?this.className+="low":P.video.volume<.67?this.className+="medium":this.className+="high",this.tooltip(ABP.Strings.mute),P.barVolume.style.width=100*P.video.volume+"%"}),P.btnWebFull[n]("click",function(){P.state.fullscreen=y(a,"ABP-FullScreen"),h(a,"ABP-FullScreen"),P.btnFull.className="button ABP-FullScreen icon-screen-normal",P.btnFull.tooltip(ABP.Strings.exitWebFull),P.state.fullscreen=!0,P.cmManager&&P.cmManager.setBounds(),P.state.allowRescale&&(P.state.fullscreen?P.defaults.w>0&&(P.cmManager.options.scrollScale=a.offsetWidth/P.defaults.w):P.cmManager.options.scrollScale=1)});var je=!1,ze=!1;P.btnFont[n]("click",function(e){ze&&P.btnColor.click(),this.parentNode.classList.toggle("on"),je=!je}),P.btnColor[n]("click",function(e){je&&P.btnFont.click(),this.parentNode.classList.toggle("on"),ze=!ze}),P.btnAutoOpacity[n]("click",function(e){this.classList.toggle("on");var t=this.classList.contains("on");P.cmManager.autoOpacity(t),this.tooltip(t?ABP.Strings.autoOpacityOn:ABP.Strings.autoOpacityOff),Ct()}),P.btnProp[n]("click",function(e){this.classList.toggle("on");var t=this.classList.contains("on");P.cmManager.useCSS(t),this.tooltip(t?ABP.Strings.usingCSS:ABP.Strings.usingCanvas),Ct()});var We=function(){!document.isFullScreen()&&y(a,"ABP-FullScreen")&&(b(a,"ABP-FullScreen"),P.btnFull.className="button ABP-FullScreen icon-screen-full",P.btnFull.tooltip(ABP.Strings.fullScreen),P.state.fullscreen=!!document.isFullScreen())};document[n]("fullscreenchange",We,!1),document[n]("webkitfullscreenchange",We,!1),document[n]("mozfullscreenchange",We,!1),document[n]("MSFullscreenChange",We,!1),P.btnFull[n]("click",function(){P.state.fullscreen=y(a,"ABP-FullScreen"),P.state.fullscreen?(b(a,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-full",this.tooltip(ABP.Strings.fullScreen),document.exitFullscreen()):(h(a,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-normal",this.tooltip(ABP.Strings.exitFullScreen),a.requestFullScreen()),P.state.fullscreen=!P.state.fullscreen,P.cmManager&&P.cmManager.setBounds(),P.state.allowRescale&&(P.state.fullscreen?P.defaults.w>0&&(P.cmManager.options.scrollScale=a.offsetWidth/P.defaults.w):P.cmManager.options.scrollScale=1)});var Xe=0;P.btnCmtListShow[n]("click",function(){var e=P.commentListContainer.parentNode.parentNode;P.state.commentListShow=y(e,"expand"),P.state.commentListShow?(Xe=P.commentListContainer.parentNode.scrollTop,b(e,"expand"),this.classList.remove("on"),this.tooltip(ABP.Strings.cmtListShow)):(h(e,"expand"),this.classList.add("on"),this.tooltip(ABP.Strings.cmtListHide),P.state.settingsShow&&P.btnSetting.click(),P.commentListContainer.parentNode.scrollTop=Xe,t(function(){P.commentListContainer.parentNode.scrollTop=Xe},100)),P.state.commentListShow=!P.state.commentListShow}),P.btnDm[n]("click",function(){0==P.cmManager.display?(P.cmManager.display=!0,P.cmManager.startTimer(),this.className="button ABP-CommentShow icon-comment on",this.tooltip(ABP.Strings.hideComment),b(P.playerUnit,"hide-comment")):(P.cmManager.display=!1,P.cmManager.clear(),P.cmManager.stopTimer(),this.className="button ABP-CommentShow icon-comment",this.tooltip(ABP.Strings.showComment),h(P.playerUnit,"hide-comment")),Ct()}),P.btnLoop[n]("click",function(){0==P.video.loop?(P.video.loop=!0,this.className="button ABP-Loop icon-loop on",this.tooltip(ABP.Strings.loopOn)):(P.video.loop=!1,this.className="button ABP-Loop icon-loop",this.tooltip(ABP.Strings.loopOff)),P.video.dispatchEvent(new CustomEvent("loop"))});var Je,Ye,Ge,Qe=P.playerUnit.querySelector(".Context-Menu"),Ke=Qe.querySelector(".Context-Menu-Background"),Ze=Qe.querySelector(".Context-Menu-Body"),$e=function(e){return gt?(e.preventDefault(),e.stopPropagation(),gt=!1,!1):(Qe.style.display="none",void e.preventDefault())},et=function(e){var i=P.commentObjArray.indexOf(e);i!==-1&&(P.state.commentListShow?P.commentListContainer.parentNode.scrollTop=24*i:(P.btnCmtListShow.click(),t(function(){P.commentListContainer.parentNode.scrollTop=24*i},100)))},tt=null,it=null,nt=0,at=null,ot={},lt=function(){if(0!=nt){if(void 0!=ot[nt])return void Ze.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:ot[nt]}));var e=r("script",{className:"info_jsonp",src:"//account.bilibili.com/api/member/getCardByMid?type=jsonp&callback=getSenderInfo&mid="+nt});document.body.appendChild(e)}},st=function(){P.copyText(this.dataset.content)},rt=function(){et(this.getAttribute("data-dmid"))},ct=function(){nt=this.getAttribute("data-mid"),at=this,tt=t(lt,500)},dt=function(){i(tt),nt=0,at=null,null!=document.getElementById("Sender-Info")&&(i(it),it=t(function(){document.getElementById("Sender-Info").remove()},500))},mt=function(){shield.addText(this.dataset.text)},ut=function(){shield.addUser(this.dataset.hash)},pt=function(){shield.addColor(this.dataset.color)},vt=function(e,t,i,n){Qe.style.display="block";var a,o,l,s,c,d=Ze.children,m=P.playerUnit.getBoundingClientRect();for(N=d.length-2;N>=0;N--)!d[N].classList.contains("preserve")&&d[N].remove();for(a=Ze.firstChild,N=0;N<i.length;N++){for(o=i[N].originalData,l=o.color.toString(16);l.length<6;)l="0"+l;if(s=16777215==o.color,c=r("div",{className:"dm"},[r("div",{className:"content"},[r("text",o.text)]),r("div",{className:"dmMenu"},[r("div",{event:{click:st},"data-content":o.text},[r("text",ABP.Strings.copyComment)]),r("div",{event:{click:rt},"data-dmid":o.dbid},[r("text",ABP.Strings.findComment)]),r("div",{event:{click:mt},"data-text":o.text},[r("text",ABP.Strings.blockContent+"“"+o.text+"”")]),r("div",{event:{click:ut,mouseenter:ct,mouseleave:dt},"data-mid":crc_engine(o.hash),"data-hash":o.hash},[r("text",ABP.Strings.blockUser+""+o.hash+"(mid:"+crc_engine(o.hash)+")")]),r("div",s?{}:{event:{click:pt},"data-color":l},[r("text",s?ABP.Strings.blockColorWhite:ABP.Strings.blockColor+""),r("div",{className:"color",style:{background:"#"+l}})])])]),o.mode>6){c.childNodes[0].textContent="特殊弹幕";var u=c.childNodes[1];u.childNodes[0].style.display="none",u.childNodes[2].style.display="none",u.childNodes[4].style.display="none"}Ze.insertBefore(c,a)}void 0!=n&&Ze.insertBefore(r("div",{event:{click:function(){n.contextMenuAction()}}},[r("div",{className:"content"},[r("text",n.contextActionName)])]),a),e-=m.left,t-=m.top,m.width-e<300&&(e=m.width-300),m.height-Ze.offsetHeight-t<0&&(t=m.height-Ze.offsetHeight);var p=Ze.querySelector(".dm:nth-last-of-type(2)>.dmMenu");null!=p&&requestAnimationFrame(function(){p.style.display="block";var i=P.playerUnit.getBoundingClientRect(),n=p.getBoundingClientRect();p.style.display="",n.top+n.height>i.top+i.height&&(t-=n.top+n.height-i.top-i.height),Ze.style.left=e+"px",Ze.style.top=t+"px"}),Ze.style.left=e+"px",Ze.style.top=t+"px"},ft=null,gt=!1,ht=!1,yt=!1,bt=!1,St=null;Ze.querySelector("#Player-Screenshot .dmMenu")[n]("click",function(e){var t="on"==e.target.dataset.comment,i=r("canvas"),n=P.video,a=i.getContext("2d"),o=window.devicePixelRatio,l=P.cmManager,s=n.paused;if(n.pause(),t){if(abpinst.cmManager.options.global.useCSS)return P.createPopup(ABP.Strings.screenshotCSSNoSupport,3e3),void(!s&&n.play());var c=Math.ceil(l.width*o),d=Math.ceil(l.height*o),m=n.videoHeight,u=n.videoWidth,p=0,f=0;i.width=c,i.height=d,a.fillStyle="black",a.fillRect(0,0,c,d),m*(c/u)<d?(m*=c/u,u=c,f=Math.floor((d-m)/2)):(u*=d/m,m=d,p=Math.floor((c-u)/2)),a.drawImage(n,p,f,u,m),a.drawImage(l.canvas,0,0)}else i.width=n.videoWidth,i.height=n.videoHeight,a.drawImage(n,0,0);try{var g=i.toDataURL(),h=window.open("about:blank");h.onload=function(){h.document.title=ABP.Strings.screenshot+" @ "+v(n.currentTime)+" - "+ABP.Strings[t?"screenshotWithComment":"screenshotWithoutComment"],h.document.body.innerHTML='<style>body{background:#222;padding:0;margin:0}img{width:100%;height:100%;object-fit:scale-down}</style><img src="'+g+'">'}}catch(e){console.error(e),P.createPopup(ABP.Strings.screenshotError,3e3),!s&&n.play()}}),Ze.querySelector("#Player-Speed-Control .dmMenu")[n]("click",function(e){var t=e.target.getAttribute("data-speed");void 0!=t&&(P.video.playbackRate=t)}),Ze[n]("senderInfoFetched",function(e){var a=e.detail;if(a.mid==nt&&null!=at){var o=at.parentNode.getBoundingClientRect(),l=o.left-150,s=innerHeight-o.bottom,c=r("div",{className:"Context-Menu-Body",id:"Sender-Info",style:{left:l+"px",bottom:s+"px",position:"fixed",fontFamily:"-apple-system,Arial,'PingFang SC','STHeiti Light','Hiragino Kaku Gothic ProN','Microsoft YaHei'",textAlign:"center",zIndex:1}},[r("div",{},[r("img",{style:{height:"130px",width:"130px"},src:a.face})]),r("div",{},[r("text",a.name)]),r("div",{},[r("text",a.mid)]),r("div",{},[r("text","LV"+a.level_info.current_level)])]);P.playerUnit.appendChild(c),s+c.offsetHeight>innerHeight&&(c.style.bottom="",c.style.top=o.top+"px"),c[n]("click",function(){window.open("/space/"+a.mid+"/"),c.remove()}),c[n]("mouseenter",function(){i(it)}),c[n]("mouseleave",function(){i(it),it=t(function(){c.remove()},500)})}}),window.getSenderInfo=function(e){0==e.code&&(ot[nt]=e.card,Ze.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:e.card})))},Qe[n]("click",$e),Ke[n]("contextmenu",$e),P.videoDiv.parentNode[n]("contextmenu",function(e){e.preventDefault(),e.stopPropagation();for(var t,i=P.divComment.getBoundingClientRect(),n=e.clientX,a=e.clientY,o=e.target;this.contains(o);){if(void 0!=o.contextMenuAction){t=o;break}o=o.parentNode}vt(n,a,P.cmManager.getCommentFromPoint(n-i.left,a-i.top),t)}),P.commentListContainer[n]("contextmenu",function(e){var t=e.target.parentNode.data;return void 0!=t&&(e.preventDefault(),e.stopPropagation(),void vt(e.clientX,e.clientY,[t]))}),window.cid&&(P.playerUnit.getElementsByClassName("ABP-Comment-List-Count")[0].contextMenuAction=function(){P.reconnectSocket()},P.playerUnit.getElementsByClassName("ABP-Comment-List-Count")[0].contextActionName=ABP.Strings.reconnectSocket,P.playerUnit.getElementsByClassName("ABP-Comment-List-Count")[0][n]("contextmenu",function(e){e.preventDefault(),e.stopPropagation(),vt(e.clientX,e.clientY,[],this)})),P.videoDiv.parentNode[n]("touchstart",function(e){if(ht=!1,yt=!1,Ge=P.video.currentTime,gt=!1,e.touches.length>1&&null!=ft)return i(ft),void(ft=null);var n=P.divComment.getBoundingClientRect(),a=e.touches[0].clientX,o=e.touches[0].clientY,l=P.cmManager.getCommentFromPoint(a-n.left,o-n.top);Je=a,Ye=o,ft=t(function(){yt=!0,ft=null,gt=!0,vt(a,o,l)},300)}),P.playerUnit.querySelector(".shield")[n]("touchstart touchmove touchend",function(e){e.stopPropagation()}),P.videoDiv.parentNode[n]("touchmove",function(e){null!=ft&&(i(ft),ft=null);var t=e.touches[0].clientX,n=e.touches[0].clientY,a=t-Je,o=n-Ye,l=P.videoDiv.getBoundingClientRect(),s=(l.width,l.height);if(ht){var r=0,c=a>0?1:0,d=["Low","Med","High"],m=P.video.duration;n<s/3?Ge+=.2*a:n<2*s/3?(Ge+=.6*a,r=1):(Ge+=1.5*a,r=2),Ge=Ge<0?0:Ge>m?m:Ge,Je+=a,Je-l.left<50||l.right-Je<50?(document.querySelector(".Drag-Icon").className="Drag-Icon cancel",ae(".Drag-Speed").textContent=ABP.Strings.dragControlCancel,ae(".Drag-Time").textContent="　",bt=!0):(document.querySelector(".Drag-Icon").className="Drag-Icon "+(c?"forward":"rewind"),ae(".Drag-Speed").textContent=ABP.Strings["dragControl"+d[r]+(c?"Inc":"Dec")],ae(".Drag-Time").textContent=v(Ge)+"╱"+v(m),bt=!1,m>0&&(document.querySelector(".Drag-Time-Bar .fill").style.width=Ge/m*100+"%"))}else yt||(a<-10||a>10?(ht=!0,null!=St&&(i(St),St=null),ae(".Drag-Control").style.display="block"):(o<-10||o>10)&&(yt=!0))}),P.videoDiv.parentNode[n]("touchend",function(){null!=ft&&(i(ft),ft=null),ht&&!bt&&(P.video.currentTime=Ge),St=t(function(){ae(".Drag-Control").style.display="none"},1e3)}),Ze[n]("touchstart",function(e){var t=Ze.getBoundingClientRect();e.touches[0].clientX-t.left<=t.width&&e.touches[0].clientY-t.top<=t.height&&(gt=!0)});var Ct=function(){P.inited&&(localStorage.html5Settings=JSON.stringify({volume:P.video.volume,opacity:P.cmManager.options.global.opacity,scale:P.commentScale,speed:P.commentSpeed,commentVisible:P.cmManager.display,autoOpacity:P.cmManager.options.global.autoOpacity,useCSS:P.cmManager.options.global.useCSS,autoPlay:P.autoPlay,defaultFull:P.defaultFull,playSpeed:P.video.playbackRate,recordPlaySpeed:P.recordPlaySpeed,theme:document.getElementById("setting-playerTheme").value,cmStyle:document.getElementById("setting-cmStyle").value,density:P.cmManager.options.global.density}))},Bt=function(){var e=new Date,i=""+e.getTime()+Math.random();return""!=P.txtText.value&&!P.txtText.disabled&&(P.playerUnit.dispatchEvent(new CustomEvent("sendcomment",{detail:{id:i,message:P.txtText.value,fontsize:P.commentFontSize,color:parseInt("0x"+P.commentColor),date:e.getFullYear()+"-"+m(e.getMonth())+"-"+m(e.getDay())+" "+m(e.getHours())+":"+m(e.getMinutes())+":"+m(e.getSeconds()),playTime:P.video.currentTime,mode:P.commentMode,pool:0}})),P.cmManager.send({text:P.txtText.value,mode:P.commentMode,stime:P.video.currentTime,size:P.commentFontSize,color:parseInt("0x"+P.commentColor),border:!0}),P.commentList[i]={date:parseInt(e.getTime()/1e3),time:1e3*P.video.currentTime,mode:P.commentMode,user:"-",pool:0,content:P.txtText.value},P.txtText.value="",P.txtText.disabled=!0,void t(function(){P.txtText.disabled=!1},P.commentCoolDown))};P.txtText.parentNode[n]("submit",function(e){return e.preventDefault(),Bt(),!1}),P.btnSend[n]("click",Bt),P.timeLabel[n]("click",function(){P.timeJump=r("input",{className:"time-jump"}),P.timeJump.value=v(P.video.currentTime),P.controlBar.appendChild(P.timeJump),P.timeJump[n]("blur",function(){P.timeJump&&P.timeJump.parentNode.removeChild(P.timeJump),P.timeJump=null}),P.timeJump[n]("keydown",function(e){if(13==e.keyCode){var t=f(P.timeJump.value);t&&t<=P.video.duration&&(P.video.currentTime=t,P.video.paused&&P.btnPlay.click()),P.timeJump.parentNode.removeChild(P.timeJump)}else(e.keyCode<48||e.keyCode>59)&&(e.keyCode<96||e.keyCode>105)&&8!=e.keyCode&&16!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&46!=e.keyCode&&e.preventDefault()}),P.timeJump.focus(),P.timeJump.select()}),P.barTime.style.width="0%";var Pt=!1;P.barTimeHitArea[n]("mousedown",function(e){Pt=!0});var xt={imgs:[],data:[],len:[0,0],size:[0,0]},At=function(e){if(0!=e.code||!e.data)return!1;var t=e.data;xt.imgs=JSON.parse(JSON.stringify(t.image).replace(/i3\.hdslb\.com/g,"img.biliplus.com/i3")),xt.len=[t.img_x_len,t.img_y_len],xt.size=[t.img_x_size,t.img_y_size];var i=new XMLHttpRequest;i.open("GET","/api/videoshot_index?file="+encodeURIComponent(t.pvdata),!0),i.onreadystatechange=function(e){if(4==i.readyState&&200==i.status){var t=JSON.parse(i.response);t.index.shift(),xt.data=t.index}},i.send()},Nt=!1;P.barTimeHitArea[n]("mouseenter",function(e){Nt=!0}),P.barTimeHitArea[n]("mouseleave",function(e){Nt=!1}),void 0!=window.cid&&getjson("/danmaku/pvinfo/"+window.cid+".json",At),P.playerUnit[n]("cidchange",function(){getjson("/danmaku/pvinfo/"+window.cid+".json",At);try{var e=JSON.parse(localStorage.playHistory||"{}");void 0!=e[cid]&&(P.lastTime=e[cid])}catch(e){}}),document[n]("mouseup",function(e){if(Pt){var t=(e.clientX-P.barTimeHitArea.getBoundingClientRect().left)/P.barTimeHitArea.offsetWidth*P.video.duration;t<0&&(t=0),Math.abs(t-P.video.currentTime)>4&&P.cmManager&&P.cmManager.clear(),P.video.currentTime=t}Pt=!1});var kt=function(e){P.barTime.style.width=e/A.duration*100+"%",P.timeLabel.textContent=v(e)+" / "+v(A.duration)};document[n]("mousemove",function(e){var t=(e.clientX-P.barTimeHitArea.getBoundingClientRect().left)/P.barTimeHitArea.offsetWidth*P.video.duration;if(t<0&&(t=0),t>P.video.duration&&(t=P.video.duration),xt.data.length>0&&null!=s("ABP-Tooltip")&&Nt){var i;for(i=0;i<xt.data.length;i++)if(t<xt.data[i]){i--;break}var n=Math.floor(i/100),a=Math.floor(i%100/10),o=i%10,l=s("preview-container"),c=s("ABP-Tooltip");null==l&&(l=r("div",{id:"preview-container",
style:{position:"absolute","background-size":xt.size[0]+"px "+xt.size[1]+"px",width:xt.size[0]+"px",height:xt.size[1]+"px",background:"rgba(0,0,0,0)",display:"none"}}),c.parentNode.insertBefore(l,c));var d=c.offsetLeft+(c.offsetWidth-xt.size[0])/2;d<5?d=5:d>P.cmManager.width-5-xt.size[0]&&(d=P.cmManager.width-5-xt.size[0]),l.style.left=d+"px",l.style.top=c.offsetTop+(c.offsetHeight-xt.size[1])+"px",l.style.display="block",l.style.backgroundImage='url("'+xt.imgs[n]+'")',l.style.backgroundPosition="-"+o*xt.size[0]+"px -"+a*xt.size[1]+"px"}null==s("ABP-Tooltip")&&null!=s("preview-container")&&(s("preview-container").style.display="none"),P.barTimeHitArea.tooltip(v(t)),Pt&&kt(t)}),g(P.barTimeHitArea,!0,-12);var wt=!1;P.barVolumeHitArea[n]("mousedown",function(e){wt=!0});var Mt=null,Tt=function(){Mt&&i(Mt),h(a,"volume-show")},_t=function(){Mt=t(function(){b(a,"volume-show")},2e3)};P.barVolumeHitArea[n]("mouseenter",Tt),P.btnVolume[n]("mouseenter",Tt),P.barVolumeHitArea[n]("mouseleave",_t),P.btnVolume[n]("mouseleave",_t),P.barVolume.style.width=100*P.video.volume+"%";var Lt=function(e){P.barVolume.style.width=Math.min(100*e,100)+"%",P.video.muted=!1,P.btnVolume.className="button ABP-Volume icon-volume-",e<.1?P.btnVolume.className+="mute":e<.33?P.btnVolume.className+="low":e<.67?P.btnVolume.className+="medium":P.btnVolume.className+="high",P.btnVolume.tooltip(ABP.Strings.mute),P.barVolumeHitArea.tooltip(parseInt(100*e)+"%"),Ct()};document[n]("mouseup",function(e){if(wt){var t=(e.clientX-P.barVolumeHitArea.getBoundingClientRect().left)/P.barVolumeHitArea.offsetWidth;t<0&&(t=0),t>1&&(t=1),P.video.volume=t,Lt(P.video.volume)}wt=!1}),document[n]("mousemove",function(e){var t=(e.clientX-P.barVolumeHitArea.getBoundingClientRect().left)/P.barVolumeHitArea.offsetWidth;t<0&&(t=0),t>1&&(t=1),wt?(P.video.volume=t,Lt(P.video.volume)):P.barVolumeHitArea.tooltip(parseInt(100*t)+"%")}),g(P.barVolumeHitArea,!0,-12);var Ht=!1;P.barOpacityHitArea[n]("mousedown",function(e){Ht=!0}),P.barOpacity.style.width=100*P.cmManager.options.global.opacity+"%";var Et=function(e){P.barOpacity.style.width=100*e+"%",P.barOpacityHitArea.tooltip(parseInt(100*e)+"%")};document[n]("mouseup",function(e){if(Ht){var t=(e.clientX-P.barOpacityHitArea.getBoundingClientRect().left)/P.barOpacityHitArea.offsetWidth;t<0&&(t=0),t>1&&(t=1),P.cmManager.options.global.opacity=t,Et(P.cmManager.options.global.opacity),Ct()}Ht=!1}),document[n]("mousemove",function(e){var t=(e.clientX-P.barOpacityHitArea.getBoundingClientRect().left)/P.barOpacityHitArea.offsetWidth;t<0&&(t=0),t>1&&(t=1),Ht?(P.cmManager.options.global.opacity=t,Et(P.cmManager.options.global.opacity)):P.barOpacityHitArea.tooltip(parseInt(100*t)+"%")}),g(P.barOpacityHitArea,!0,-6);var Ft=!1;P.barScaleHitArea[n]("mousedown",function(e){Ft=!0}),P.barScale.style.width=(P.commentScale-.2)/1.8*100+"%";var Dt=function(e){P.barScale.style.width=(e-.2)/1.8*100+"%",P.barScaleHitArea.tooltip(parseInt(100*e)+"%"),P.cmManager.setBounds()};document[n]("mouseup",function(e){if(Ft){var t=.2+1.8*(e.clientX-P.barScaleHitArea.getBoundingClientRect().left)/P.barScaleHitArea.offsetWidth;t<.2&&(t=.2),t>2&&(t=2),P.commentScale=t,Dt(P.commentScale),Ct()}Ft=!1}),document[n]("mousemove",function(e){var t=.2+1.8*(e.clientX-P.barScaleHitArea.getBoundingClientRect().left)/P.barScaleHitArea.offsetWidth;t<.2&&(t=.2),t>2&&(t=2),Ft?(P.commentScale=t,Dt(P.commentScale)):P.barScaleHitArea.tooltip(parseInt(100*t)+"%")}),g(P.barScaleHitArea,!0,-6);var It=!1;P.barDensityHitArea[n]("mousedown",function(){It=!0});var Ot=function(e){return e>=5&&e<100?5*(e/5|0):e>=100&&e<=1e3?100*(e/100|0):0},Rt=function(e){e=Ot(e);var t=100;e>=5&&e<100?t=(e/5-1)/19*80:e>=100&&e<=1e3&&(t=(e/100-1)/9*15+80),P.barDensity.style.width=t+"%",P.barDensityHitArea.tooltip(e||"无限制")};document[n]("mouseup",function(e){if(It){var t=(e.clientX-P.barScaleHitArea.getBoundingClientRect().left)/P.barScaleHitArea.offsetWidth,i=0;t>=0&&t<.8?i=5*Math.round(t/.8*19)+5:t>=.8&&t<=.95&&(i=100*Math.round((t-.8)/.15*9)+100),P.cmManager.options.global.density=i,Rt(i),Ct()}It=!1}),document[n]("mousemove",function(e){var t=(e.clientX-P.barScaleHitArea.getBoundingClientRect().left)/P.barScaleHitArea.offsetWidth,i=0;t>=0&&t<.8?i=5*Math.round(t/.8*19)+5:t>=.8&&t<=.95&&(i=100*Math.round((t-.8)/.15*9)+100),It?(P.cmManager.options.global.density=i,Rt(i)):P.barDensityHitArea.tooltip(i||"无限制")}),g(P.barDensityHitArea,!0,-6),Rt(P.cmManager.options.global.density);var Ut=!1;P.barSpeedHitArea[n]("mousedown",function(e){Ut=!0}),P.barSpeed.style.width=(P.commentSpeed-.5)/1.5*100+"%";var Vt=function(e){P.barSpeed.style.width=(e-.5)/1.5*100+"%",P.barSpeedHitArea.tooltip(parseInt(100*e)+"%"),P.cmManager.setBounds(),Ct()};document[n]("mouseup",function(e){if(Ut){var t=.5+1.5*(e.clientX-P.barSpeedHitArea.getBoundingClientRect().left)/P.barSpeedHitArea.offsetWidth;t<.5&&(t=.5),t>2&&(t=2),P.commentSpeed=t,Vt(P.commentSpeed),Ct()}Ut=!1}),document[n]("mousemove",function(e){var t=.5+1.5*(e.clientX-P.barSpeedHitArea.getBoundingClientRect().left)/P.barSpeedHitArea.offsetWidth;t<.5&&(t=.5),t>2&&(t=2),Ut?(P.commentSpeed=t,Vt(P.commentSpeed)):P.barSpeedHitArea.tooltip(parseInt(100*t)+"%")}),g(P.barSpeedHitArea,!0,-6);var qt=!1;P.barPlaySpeedHitArea[n]("mousedown",function(e){qt=!0}),P.barPlaySpeed.style.width=(P.video.playbackRate-.5)/1.5*100+"%";var jt=function(e){P.barPlaySpeed.style.width=(e-.5)/1.5*100+"%",P.barPlaySpeedHitArea.tooltip(e.toFixed(2)+"x")};document[n]("mouseup",function(e){if(qt){var t=.5+1.5*(e.clientX-P.barPlaySpeedHitArea.getBoundingClientRect().left)/P.barPlaySpeedHitArea.offsetWidth;t<.5&&(t=.5),t>2&&(t=2),P.video.playbackRate=t}qt=!1}),document[n]("mousemove",function(e){var t=.5+1.5*(e.clientX-P.barPlaySpeedHitArea.getBoundingClientRect().left)/P.barPlaySpeedHitArea.offsetWidth;t<.5&&(t=.5),t>2&&(t=2),qt?P.video.playbackRate=t:P.barPlaySpeedHitArea.tooltip(t.toFixed(2)+"x")}),g(P.barPlaySpeedHitArea,!0,-6),P.btnPlay[n]("click",function(){P.video.paused?P.video.play():P.video.pause()}),a[n]("keydown",function(e){if(e&&"INPUT"!=document.activeElement.tagName)switch([27,32,37,38,39,40].indexOf(e.keyCode)!=-1&&e.preventDefault(),e.keyCode){case 27:P.state.fullscreen&&P.btnFull.click();break;case 32:P.btnPlay.click();break;case 37:var t=P.video.currentTime-=5*P.video.playbackRate;P.cmManager.clear();var i=B(P.video);i.start-t>0&&i.start-t<4&&(t=i.start),t<0&&(t=0),P.video.currentTime=t.toFixed(3),P.video.paused&&P.btnPlay.click(),kt(A.currentTime),P.barTimeHitArea.tooltip(v(A.currentTime));break;case 39:var t=P.video.currentTime+=5*P.video.playbackRate;P.cmManager.clear();var i=B(P.video);i.end-t<0&&i.end-t>-4&&(t=i.end-1),t>P.video.duration&&(t=P.video.duration),P.video.currentTime=t.toFixed(3),P.video.paused&&P.btnPlay.click(),kt(A.currentTime),P.barTimeHitArea.tooltip(v(A.currentTime));break;case 38:if(e.ctrlKey){var n=P.video.playbackRate+.05;n>2&&(n=2),P.video.playbackRate=n.toFixed(3),P.removePopup(),P.createPopup(ABP.Strings.rateChange+(100*n|0)+"%",1e3)}else{var a=P.video.volume,o=a+(a>=1?.25:.1),l=1;o>l&&(o=l),P.video.volume=o.toFixed(3),Lt(P.video.volume),P.removePopup(),P.createPopup(ABP.Strings.volumeChange+(100*o|0)+"%",1e3)}break;case 40:if(e.ctrlKey){var n=P.video.playbackRate-.05;n<.5&&(n=.5),P.video.playbackRate=n.toFixed(3),P.removePopup(),P.createPopup(ABP.Strings.rateChange+(100*n|0)+"%",1e3)}else{var a=P.video.volume,o=a-(a>1?.25:.1);o<0&&(o=0),P.video.volume=o.toFixed(3),Lt(P.video.volume),P.removePopup(),P.createPopup(ABP.Strings.volumeChange+(100*o|0)+"%",1e3)}}}),a.firstChild[n]("touchmove",function(e){e.preventDefault()});var zt=null;a[n]("touchstart",function(e){y(P.videoDiv,"ABP-HideCursor")&&(b(P.videoDiv,"ABP-HideCursor"),P.playerUnit.dispatchEvent(new Event("HideCursor"))),e.targetTouches.length>0&&(zt=e.targetTouches[0])}),a[n]("touchend",function(e){if(h(P.videoDiv,"ABP-HideCursor"),P.playerUnit.dispatchEvent(new Event("HideCursor")),e.changedTouches.length>0&&null!=zt){var t=e.changedTouches[0].pageX-zt.pageX,i=e.changedTouches[0].pageY-zt.pageY;if(Math.abs(t)<20&&Math.abs(i)<20)return void(zt=null);Math.abs(t)>3*Math.abs(i)?t>0?P.video.paused&&P.btnPlay.click():P.video.paused||P.btnPlay.click():Math.abs(i)>3*Math.abs(t)&&(i<0?P.video.volume=Math.min(1,P.video.volume+.1):P.video.volume=Math.max(0,P.video.volume-.1)),zt=null}}),a[n]("mouseup",function(){if("INPUT"!=document.activeElement.tagName){var e=window.scrollY;P.videoDiv.focus(),window.scrollTo(window.scrollX,e)}})}if("undefined"!=typeof CommentManager&&P.state.autosize){var Wt=function(){if(0!==A.videoHeight&&0!==A.videoWidth){var e=A.videoHeight/A.videoWidth,t=a.offsetWidth,i=a.offsetHeight,n=i/t;n<e?(a.style.width=i/e+"px",a.style.height=i+"px"):(a.style.width=t+"px",a.style.height=t*e+"px"),P.cmManager.setBounds()}};A[n]("loadedmetadata",Wt),Wt()}if(window.cid&&window.WebSocket){var Xt=function(){function e(e,t){var i=new Uint8Array(e),n=new Uint8Array(t),a=new Uint8Array(e.byteLength+t.byteLength);return a.set(i,0),a.set(n,e.byteLength),a.buffer}function t(e){this.connection=new WebSocket("wss://tx.biliplus.com:7823/sub"),this.connection.binaryType="arraybuffer",this.connection.onopen=this.firstConnection.bind(this),this.connection.onmessage=i.bind(this),this.connection.onclose=n.bind(this),this.connection.onerror=a.bind(this),this.roomid=e}function i(e){var t=e.data,i=new DataView(t,0),n=i.getUint32(s);if(i.byteLength>=n){var a=i.getInt16(r),l=(i.getInt16(c),i.getUint32(d));i.getUint32(m);switch(l){case 8:this.heartBeat(),o=setInterval(this.heartBeat.bind(this),1e4);break;case 3:case 5:for(var p,v=i,f=t,g=0;g<f.byteLength;g+=n)n=v.getUint32(g),a=v.getInt16(g+r),p=u(f.slice(g+a,g+n)),this._listener&&this._listener("msg",p);break;case 1e3:for(var p,v=i,f=t,g=0;g<f.byteLength;g+=n)n=v.getUint32(g),a=v.getInt16(g+r),p=u(f.slice(g+a,g+n)),this._listener&&this._listener("msg_v2",p)}}}function n(){o&&clearInterval(o),this._listener&&this._listener("close")}function a(){this._listener&&this._listener("error")}var o,l=18,s=0,r=4,c=6,d=8,m=12,u=function(e){return decodeURIComponent(window.escape(String.fromCharCode.apply(null,new Uint8Array(e))))},p=function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),n=0,a=e.length;n<a;n++)i[n]=e.charCodeAt(n);return i};return t.prototype.firstConnection=function(){var t=window.getSocketAuth?window.getSocketAuth():JSON.stringify({room_id:"video://7/"+this.roomid,platform:"web",accepts:[1e3]}),i=new ArrayBuffer(l),n=new DataView(i,0),a=p(t);n.setInt32(s,l+a.byteLength),n.setInt16(r,l),n.setInt16(c,1),n.setInt32(d,7),n.setInt32(m,1),this.connection.send(e(i,a))},t.prototype.heartBeat=function(){var e=new ArrayBuffer(l),t=new DataView(e,0);t.setInt32(s,l),t.setInt16(r,l),t.setInt16(c,1),t.setInt32(d,2),t.setInt32(m,1),this.connection.send(e)},t.prototype.closeHeartBeat=function(){clearInterval(this.heartBeating)},t.prototype.send=function(e){this.connection.send(e)},t.prototype.close=function(){this.connection.close()},t.prototype.setListener=function(e){this._listener=e},t.prototype.removeListener=function(){this._listener=null},t}(),Jt=new Xt(window.cid),Yt=1;Jt.setListener(c),P.reconnectSocket=function(){Jt.removeListener(),Jt.close(),Jt=new Xt(window.cid),Jt.setListener(c)}}var Gt=function(e){var t=P.state.commentListShow,i=P.playerUnit.querySelector(".ABP-Player .ABP-Comment-List-Count"),n=P.playerUnit.querySelector(".ABP-Comment-List .ABP-Comment-List-Count");if(t||null==n){if(t&&null!=i){var a=P.playerUnit.querySelector(".ABP-Comment-List");a.insertBefore(i,a.childNodes[0])}}else P.playerUnit.querySelector(".ABP-Player").appendChild(n)};P.controlBar[n]("click",Gt),Gt(),shield.init(P);var Qt={},Kt=null,Zt="",$t="",ei=P.playerUnit.querySelector("#setting-subtitles-primary"),ti=P.playerUnit.querySelector("#setting-subtitles-secondary"),ii=P.playerUnit.querySelector("#setting-subtitles-group");ei.addEventListener("change",function(){Zt=this.value,""===Zt?($t="",ti.value="",ti.disabled=!0,ci()):(ti.disabled=!1,(ti.querySelector("option[disabled]")||{}).disabled=!1,ti.querySelector('option[value="'+Zt+'"]').disabled=!0,$t===Zt&&($t=""),Qt[Zt].data?ri():li())}),ti.addEventListener("change",function(){$t=this.value,""===$t||Qt[$t].data?ri():li()}),P.playerUnit[n]("ABP-Subtitles",function(e){Qt=e.detail;var t=Object.keys(Qt);if(0==t.length)ii.style.display="none";else{for(ii.style.display="",Zt="",$t="",ti.disabled=!0;ei.children.length>1;)ei.children[1].remove();for(;ti.children.length>1;)ti.children[1].remove();t.forEach(function(e){ei.appendChild(r("option",{value:e},[r("text",e+" - "+Qt[e].desc)])),ti.appendChild(r("option",{value:e},[r("text",e+" - "+Qt[e].desc)]))}),P.createPopup(ABP.Strings.hasSubtitles)}});var ni=function(){return"YouTube"==P.playerUnit.getAttribute("theme")?P.videoDiv.classList.contains("ABP-HideCursor")?-2:-4:P.state.fullscreen?P.videoDiv.classList.contains("ABP-HideCursor")?-2:-3:-2},ai=function(){if(P.video.textTracks.length)for(var e=P.video.textTracks[0].cues,t=0;t<e.length;t++)e[t].line="auto",e[t].line=ni()};P.playerUnit[n]("HideCursor",ai),window[n]("resize",ai),P.playerUnit[n]("themeChange",ai);var oi=null,li=function(){if(""!==Zt&&null==oi){var e;if(Qt[Zt].data){if(""===$t||Qt[$t].data)return ri();e=$t}else e=Zt;oi=new XMLHttpRequest,oi.open("GET",Qt[e].url,!0),oi.responseType="json",oi.onload=function(){Qt[e].data=this.response,oi=null,li()},oi.send()}},si=document.head.appendChild(r("style")),ri=function(){if(ci(),""!==Zt){var e=["WEBVTT"],t="::cue{font-family:inherit";""!==$t&&(e=e.concat(d(Qt[$t].data.body,"secondary")),t+="::cue(.secondary){ font-size:70%; line-height:70% }"),e=e.concat(d(Qt[Zt].data.body,"primary"));var i=e.join("\n\n");si.textContent=t;var n=new Blob([i],{type:"text/vtt"});Kt=URL.createObjectURL(n),P.video.appendChild(r("track",{src:Kt,kind:"subtitles"})),P.video.textTracks[0].mode="showing",requestAnimationFrame(ai)}},ci=function(){for(var e=P.video.textTracks,t=0;t<e.length;t++)e[t].mode="hidden";for(e=P.video.getElementsByTagName("track");e.length;)e[0].remove();Kt&&(URL.revokeObjectURL(Kt),Kt=null)};return P}}}}}}}}}}}}}}}}}}}}}}}}}}}})(),function(e){var t=function(){var t='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"><div class="colpick_selector_inner"></div></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_submit"></div></div>',i={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:!0,flat:!1,layout:"full",submit:1,submitText:"OK",height:156},l=function(t,i){var n=o(t);e(i).data("colpick").fields.eq(1).val(n.r).end().eq(2).val(n.g).end().eq(3).val(n.b).end()},r=function(t,i){e(i).data("colpick").fields.eq(4).val(Math.round(t.h)).end().eq(5).val(Math.round(t.s)).end().eq(6).val(Math.round(t.b)).end()},c=function(t,i){e(i).data("colpick").fields.eq(0).val(s(t))},d=function(t,i){e(i).data("colpick").selector.css("backgroundColor","#"+s({h:t.h,s:100,b:100})),e(i).data("colpick").selectorIndic.css({left:parseInt(e(i).data("colpick").height*t.s/100,10),top:parseInt(e(i).data("colpick").height*(100-t.b)/100,10)})},m=function(t,i){e(i).data("colpick").hue.css("top",parseInt(e(i).data("colpick").height-e(i).data("colpick").height*t.h/360,10))},u=function(t,i){e(i).data("colpick").currentColor.css("backgroundColor","#"+s(t))},p=function(t,i){e(i).data("colpick").newColor.css("backgroundColor","#"+s(t))},v=function(t){var i,u=e(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?(u.data("colpick").color=i=n(L(this.value)),l(i,u.get(0)),r(i,u.get(0))):this.parentNode.className.indexOf("_hsb")>0?(u.data("colpick").color=i=T({h:parseInt(u.data("colpick").fields.eq(4).val(),10),s:parseInt(u.data("colpick").fields.eq(5).val(),10),b:parseInt(u.data("colpick").fields.eq(6).val(),10)}),l(i,u.get(0)),c(i,u.get(0))):(u.data("colpick").color=i=a(_({r:parseInt(u.data("colpick").fields.eq(1).val(),10),g:parseInt(u.data("colpick").fields.eq(2).val(),10),b:parseInt(u.data("colpick").fields.eq(3).val(),10)})),c(i,u.get(0)),r(i,u.get(0))),d(i,u.get(0)),m(i,u.get(0)),p(i,u.get(0)),u.data("colpick").onChange.apply(u.parent(),[i,s(i),o(i),u.data("colpick").el,0])},f=function(t){e(this).parent().removeClass("colpick_focus")},g=function(){e(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus"),e(this).parent().addClass("colpick_focus")},h=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var i=e(this).parent().find("input").focus(),n={el:e(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:i,val:parseInt(i.val(),10),preview:e(this).parent().parent().data("colpick").livePreview};e(document).mouseup(n,b),e(document).mousemove(n,y)},y=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val-e.pageY+e.data.y,10)))),e.data.preview&&v.apply(e.data.field.get(0),[!0]),!1},b=function(t){return v.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colpick_slider").find("input").focus(),e(document).off("mouseup",b),e(document).off("mousemove",y),!1},S=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var i={cal:e(this).parent(),y:e(this).offset().top};e(document).on("mouseup touchend",i,B),e(document).on("mousemove touchmove",i,C);var n="touchstart"==t.type?t.originalEvent.changedTouches[0].pageY:t.pageY;return v.apply(i.cal.data("colpick").fields.eq(4).val(parseInt(360*(i.cal.data("colpick").height-(n-i.y))/i.cal.data("colpick").height,10)).get(0),[i.cal.data("colpick").livePreview]),!1},C=function(e){var t="touchmove"==e.type?e.originalEvent.changedTouches[0].pageY:e.pageY;return v.apply(e.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.y)))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]),!1},B=function(t){return l(t.data.cal.data("colpick").color,t.data.cal.get(0)),c(t.data.cal.data("colpick").color,t.data.cal.get(0)),e(document).off("mouseup touchend",B),e(document).off("mousemove touchmove",C),!1},P=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var i={cal:e(this).parent(),pos:e(this).offset()};i.preview=i.cal.data("colpick").livePreview,e(document).on("mouseup touchend",i,A),e(document).on("mousemove touchmove",i,x);var n,a;return"touchstart"==t.type?(n=t.originalEvent.changedTouches[0].pageX,a=t.originalEvent.changedTouches[0].pageY):(n=t.pageX,a=t.pageY),v.apply(i.cal.data("colpick").fields.eq(6).val(parseInt(100*(i.cal.data("colpick").height-(a-i.pos.top))/i.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(n-i.pos.left)/i.cal.data("colpick").height,10)).get(0),[i.preview]),!1},x=function(e){var t,i;return"touchmove"==e.type?(t=e.originalEvent.changedTouches[0].pageX,i=e.originalEvent.changedTouches[0].pageY):(t=e.pageX,i=e.pageY),v.apply(e.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,i-e.data.pos.top)))/e.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.pos.left))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]),!1},A=function(t){return l(t.data.cal.data("colpick").color,t.data.cal.get(0)),c(t.data.cal.data("colpick").color,t.data.cal.get(0)),e(document).off("mouseup touchend",A),e(document).off("mousemove touchmove",x),!1},N=function(t){var i=e(this).parent(),n=i.data("colpick").color;i.data("colpick").origColor=n,u(n,i.get(0)),i.data("colpick").onSubmit(n,s(n),o(n),i.data("colpick").el)},k=function(t){t.stopPropagation();var i=e("#"+e(this).data("colpickId"));i.data("colpick").onBeforeShow.apply(this,[i.get(0)]);var n=e(this).offset(),a=n.top+this.offsetHeight,o=n.left,l=M(),s=i.width();o+s>l.l+l.w&&(o-=s),i.css({left:o+"px",top:a+"px"}),0!=i.data("colpick").onShow.apply(this,[i.get(0)])&&i.show(),e("html").mousedown({cal:i},w),i.mousedown(function(e){e.stopPropagation()})},w=function(t){0!=t.data.cal.data("colpick").onHide.apply(this,[t.data.cal.get(0)])&&t.data.cal.hide(),e("html").off("mousedown",w)},M=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth)}},T=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},_=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},L=function(e){var t=6-e.length;if(t>0){for(var i=[],n=0;n<t;n++)i.push("0");i.push(e),e=i.join("")}return e},H=function(){var t=e(this).parent(),i=t.data("colpick").origColor;t.data("colpick").color=i,l(i,t.get(0)),c(i,t.get(0)),r(i,t.get(0)),d(i,t.get(0)),m(i,t.get(0)),p(i,t.get(0))};return{init:function(o){if(o=e.extend({},i,o||{}),"string"==typeof o.color)o.color=n(o.color);else if(void 0!=o.color.r&&void 0!=o.color.g&&void 0!=o.color.b)o.color=a(o.color);else{if(void 0==o.color.h||void 0==o.color.s||void 0==o.color.b)return this;o.color=T(o.color)}return this.each(function(){if(!e(this).data("colpickId")){var i=e.extend({},o);i.origColor=o.color;var n="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colpickId",n);var a=e(t).attr("id",n);a.addClass("colpick_"+i.layout+(i.submit?"":" colpick_"+i.layout+"_ns")),"light"!=i.colorScheme&&a.addClass("colpick_"+i.colorScheme),a.find("div.colpick_submit").html(i.submitText).click(N),i.fields=a.find("input").change(v).blur(f).focus(g),a.find("div.colpick_field_arrs").mousedown(h).end().find("div.colpick_current_color").click(H),i.selector=a.find("div.colpick_color").on("mousedown touchstart",P),i.selectorIndic=i.selector.find("div.colpick_selector_outer"),i.el=this,i.hue=a.find("div.colpick_hue_arrs"),huebar=i.hue.parent();var s=navigator.userAgent.toLowerCase(),y="Microsoft Internet Explorer"===navigator.appName,b=y?parseFloat(s.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0,C=y&&b<10,B=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(C){var x,A;for(x=0;x<=11;x++)A=e("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+B[x]+", endColorstr="+B[x+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+B[x]+", endColorstr="+B[x+1]+')";'),huebar.append(A)}else stopList=B.join(","),huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ");a.find("div.colpick_hue").on("mousedown touchstart",S),i.newColor=a.find("div.colpick_new_color"),i.currentColor=a.find("div.colpick_current_color"),a.data("colpick",i),l(i.color,a.get(0)),r(i.color,a.get(0)),c(i.color,a.get(0)),m(i.color,a.get(0)),d(i.color,a.get(0)),u(i.color,a.get(0)),p(i.color,a.get(0)),i.flat?(a.appendTo(this).show(),a.css({position:"relative",display:"block"})):(a.appendTo(document.body),e(this).on(i.showEvent,k),a.css({position:"absolute"}))}})},showPicker:function(){return this.each(function(){e(this).data("colpickId")&&k.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colpickId")&&e("#"+e(this).data("colpickId")).hide()})},setColor:function(t,i){if(i="undefined"==typeof i?1:i,"string"==typeof t)t=n(t);else if(void 0!=t.r&&void 0!=t.g&&void 0!=t.b)t=a(t);else{if(void 0==t.h||void 0==t.s||void 0==t.b)return this;t=T(t)}return this.each(function(){if(e(this).data("colpickId")){var n=e("#"+e(this).data("colpickId"));n.data("colpick").color=t,n.data("colpick").origColor=t,l(t,n.get(0)),r(t,n.get(0)),c(t,n.get(0)),m(t,n.get(0)),d(t,n.get(0)),p(t,n.get(0)),n.data("colpick").onChange.apply(n.parent(),[t,s(t),o(t),n.data("colpick").el,1]),i&&u(t,n.get(0))}})}}}(),i=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(65280&e)>>8,b:255&e}},n=function(e){return a(i(e))},a=function(e){var t={h:0,s:0,b:0},i=Math.min(e.r,e.g,e.b),n=Math.max(e.r,e.g,e.b),a=n-i;return t.b=n,t.s=0!=n?255*a/n:0,0!=t.s?e.r==n?t.h=(e.g-e.b)/a:e.g==n?t.h=2+(e.b-e.r)/a:t.h=4+(e.r-e.g)/a:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},o=function(e){var t={},i=e.h,n=255*e.s/100,a=255*e.b/100;if(0==n)t.r=t.g=t.b=a;else{var o=a,l=(255-n)*a/255,s=(o-l)*(i%60)/60;360==i&&(i=0),i<60?(t.r=o,t.b=l,t.g=l+s):i<120?(t.g=o,t.b=l,t.r=o-s):i<180?(t.g=o,t.r=l,t.b=l+s):i<240?(t.b=o,t.r=l,t.g=o-s):i<300?(t.b=o,t.g=l,t.r=l+s):i<360?(t.r=o,t.g=l,t.b=o-s):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},l=function(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(i,function(e,t){1==t.length&&(i[e]="0"+t)}),i.join("")},s=function(e){return l(o(e))};e.fn.extend({colpick:t.init,colpickHide:t.hidePicker,colpickShow:t.showPicker,colpickSetColor:t.setColor}),e.extend({colpick:{rgbToHex:l,rgbToHsb:a,hsbToHex:s,hsbToRgb:o,hexToHsb:n,hexToRgb:i}})}(jQuery);